// ... existing code ...
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage获取当前用户信息
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || !currentUser.id) {
                console.error('未找到用户信息，请重新登录');
                // 如果没有用户信息，跳转到登录页面
                window.location.href = 'simple_login.html';
                return;
            }
            
            const currentUserId = currentUser.id;
            console.log('当前用户ID:', currentUserId);
            
            // 设置页面标题显示用户名
            document.title = `糖域卫士 - ${currentUser.username}`;
            
            // 初始化标签页切换
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 移除所有active类
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 添加active类到当前标签和内容
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // 如果是周报或月报，加载对应的报告（使用真实用户ID）
                    if (tabId === 'weekly-report') {
                        loadAIReport(currentUserId, 'week');
                    } else if (tabId === 'monthly-report') {
                        loadAIReport(currentUserId, 'month');
                    } else if (tabId === 'feedback') {
                        loadRecommendations(currentUserId);
                    }
                });
            });
            
            // 提交反馈表单
            const feedbackForm = document.querySelector('#feedback form');
            if (feedbackForm) {
                feedbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const feedbackType = document.getElementById('feedback-type').value;
                    const feedbackContent = document.getElementById('feedback-content').value.trim();
                    
                    if (feedbackContent) {
                        submitFeedback(currentUserId, feedbackType, feedbackContent);
                    } else {
                        alert('请填写反馈内容');
                    }
                });
            }
            
            // 如果当前选中的是AI个性化分析，加载对应内容
            if (document.getElementById('personal-analysis').classList.contains('active')) {
                loadAIReport(currentUserId, 'week');
            }
        });
// ... existing code ...