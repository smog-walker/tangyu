<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³–åŸŸå«å£«â€”â€”æŒç»­æ€§è¡€ç³–ç›‘æµ‹ä¸ç”Ÿæ´»æ–¹å¼å¹²é¢„ç³»ç»Ÿ</title>
    <!-- ä¿®å¤JSæ–‡ä»¶å¼•ç”¨ - ä½¿ç”¨ç›¸å¯¹è·¯å¾„ -->
    <script src="./apiClient.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ç«‹å³æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œé˜²æ­¢é¡µé¢å†…å®¹é—ªçƒ
        (function() {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            const currentUser = localStorage.getItem('currentUser');
            
            // å¦‚æœæœªç™»å½•ï¼Œç«‹å³è·³è½¬åˆ°ç™»å½•é¡µé¢
            if (!currentUser) {
                console.log('æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                window.location.href = 'simple_login.html';
            }
        })();
    </script>
    <style>
        :root {
            --primary-color: #1890ff;
            --secondary-color: #096dd9;
            --accent-color: #f5222d;
            --light-color: #f0f2f5;
            --dark-color: #1f1f1f;
            --gray-color: #666666;
            --light-gray: #e8e8e8;
            --white: #ffffff;
            --success-color: #52c41a;
            --warning-color: #fa8c16;
            --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
        }

        html {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            display: flex;
            min-height: 100vh;
            width: 100vw;
            color: var(--dark-color);
            line-height: 1.6;
            position: relative;
            margin: 0;
            padding: 0;
            overflow: auto;
            /* ä¿®å¤èƒŒæ™¯å›¾ç‰‡è·¯å¾„ */
            background-image: url('./images/background.jpg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            z-index: 0;
        }
        
        /* å†…å®¹åŒºåŸŸæ ·å¼ - åŠé€æ˜èƒŒæ™¯ï¼Œè®©èƒŒæ™¯å›¾å¯è§ */
        .content {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.7);
            position: relative;
            z-index: 1;
        }

        /* å·¦ä¾§å¯¼èˆªæ æ ·å¼ - é€æ˜èƒŒæ™¯ */
        .sidebar {
            width: 250px;
            background-color: rgba(255, 255, 255, 0.6);
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 25px;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #bae0ff;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "ğŸ›¡ï¸";
            margin-right: 10px;
            font-size: 28px;
        }

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toolbar-button {
            padding: 14px 18px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            color: var(--dark-color);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .toolbar-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(24, 144, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .toolbar-button:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .toolbar-button:hover::before {
            left: 100%;
        }
        
        .toolbar-button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px rgba(24, 144, 255, 0.4);
            transform: translateX(5px);
        }

        /* ç”¨æˆ·ç®¡ç†æŒ‰é’® - å³ä¸Šè§’ */
        .user-management-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .user-management-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(24, 144, 255, 0.4);
            background: linear-gradient(135deg, var(--secondary-color), #004085);
        }


        
        /* å³ä¾§å†…å®¹åŒºåŸŸ - åŠé€æ˜èƒŒæ™¯ï¼Œå‡å°‘å¤–è¾¹è·é¿å…ç•™ç™½ */
        .content {
            flex: 1;
            padding: 30px;
            margin: 10px;
            background-color: rgba(255, 255, 255, 0.6);
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* æ·»åŠ å¹³æ»‘æ»šåŠ¨æ•ˆæœ */
        html {
            scroll-behavior: smooth;
        }

        /* å…¨å±€åŠ¨ç”»ç±» */
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
            opacity: 0;
        }

        /* æ·»åŠ å¾®äº¤äº’æ•ˆæœ */
        * {
            transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        h2 {
            color: var(--secondary-color);
            margin-bottom: 30px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--primary-color);
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            position: relative;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background-color: var(--accent-color);
            border-radius: 3px;
        }

        /* é¦–é¡µæ ·å¼ */
        .home-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .large-image {
            width: 100%;
            height: 420px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
            font-size: 18px;
            transition: transform 0.5s ease, box-shadow 0.5s ease;
            position: relative;
        }

        .large-image:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
        }

        .large-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 60%, rgba(0, 0, 0, 0.4));
            z-index: 1;
        }

        .large-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .small-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .small-image {
            width: 100%;
            height: 280px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
            position: relative;
            cursor: pointer;
        }

        .small-image:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .small-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(245, 34, 45, 0.05) 100%);
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .small-image:hover::before {
            opacity: 1;
        }

        .small-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ç”¨æˆ·ç®¡ç†æ ·å¼ */
        .user-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background-color: rgba(255, 255, 255, 0.8);
            position: relative;
            z-index: 1;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);
            background-color: var(--white);
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary-color);
            transition: var(--transition);
        }

        .form-group:focus-within label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
            z-index: -1;
        }

        .btn:hover::before {
            transform: translateX(100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(24, 144, 255, 0.4);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--gray-color);
            border: 1px solid var(--light-gray);
        }

        .btn-secondary:hover {
            background-color: var(--gray-color);
            color: var(--white);
            border-color: var(--gray-color);
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 12px 24px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--light-gray);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            margin-right: 10px;
            position: relative;
            overflow: hidden;
        }

        .tab-btn:hover {
            background-color: rgba(24, 144, 255, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-color: var(--primary-color);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ç¦ç”¨æ ·å¼ */
        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .disabled:hover {
            background-color: var(--light-color) !important;
            color: var(--text-color) !important;
            transform: none !important;
        }

        /* æ•°æ®è®°å½•æ ·å¼ */
        .record-form {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .record-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .record-card {
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .record-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            border-radius: 3px 0 0 3px;
        }

        .record-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            background-color: rgba(255, 255, 255, 0.9);
        }

        .record-card:hover::before {
            width: 8px;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        .record-type {
            font-weight: 600;
            color: var(--primary-color);
        }

        .record-date {
            color: var(--gray-color);
            font-size: 14px;
        }

        .record-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
            transition: var(--transition);
        }

        .record-card:hover .record-value {
            color: var(--secondary-color);
            transform: scale(1.05);
            display: inline-block;
            margin-bottom: 8px;
        }

        .record-notes {
            color: var(--gray-color);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .record-actions {
            display: flex;
            gap: 10px;
        }

        .record-btn {
            padding: 6px 12px;
            background-color: var(--light-gray);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .record-btn.edit {
            background-color: rgba(74, 144, 226, 0.1);
            color: var(--primary-color);
        }

        .record-btn.delete {
            background-color: rgba(255, 107, 107, 0.1);
            color: var(--accent-color);
        }

        .record-btn:hover {
            opacity: 0.8;
        }

        /* åˆ†ææŠ¥å‘Šæ ·å¼ */
        .report-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .report-card {
            border: 1px solid var(--light-gray);
            border-radius: 10px;
            padding: 20px;
            background-color: var(--white);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .report-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }

        .report-title {
            font-weight: 600;
            font-size: 18px;
            color: var(--secondary-color);
        }

        .report-date {
            color: var(--gray-color);
            font-size: 14px;
        }

        .report-content {
            margin-bottom: 20px;
            line-height: 1.7;
            color: var(--dark-color);
        }

        .report-actions {
            display: flex;
            gap: 15px;
        }

        .report-action {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
            font-size: 14px;
        }

        .report-action:hover {
            color: var(--primary-color);
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            height: 300px;
            background-color: var(--light-gray);
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
            position: relative;
            overflow: hidden;
        }
        
        /* AIåˆ†ææŠ¥å‘Šç‰¹å®šæ ·å¼ */
        .analysis-tabs {
            margin-bottom: 25px;
        }
        
        .analysis-tabs .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 10px;
        }
        
        .analysis-tabs .tab-btn {
            padding: 12px 20px;
            background-color: var(--light-color);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 15px;
        }
        
        .analysis-tabs .tab-btn:hover {
            background-color: var(--light-gray);
        }
        
        .analysis-tabs .tab-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--white);
        }
        
        .analysis-tabs .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .analysis-tabs .tab-content.active {
            display: block;
        }
        
        /* è¡€ç³–å€¼çŠ¶æ€æ ·å¼ */
        .bg-normal {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .bg-high {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .bg-low {
            color: var(--warning-color);
            font-weight: 600;
        }
        
        /* åé¦ˆè¡¨å•æ ·å¼ */
        #feedback form {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
margin-top: 20px;
        }
        
        #feedback form .form-group {
            margin-bottom: 15px;
        }
        
        #feedback form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--secondary-color);
        }
        
        #feedback form select,
        #feedback form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            font-size: 14px;
        }
        
        #feedback form textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        #feedback form button[type="submit"] {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }
        
        #feedback form button[type="submit"]:hover:not(:disabled) {
            background-color: var(--secondary-color);
        }
        
        #feedback form button[type="submit"]:disabled {
            background-color: var(--light-gray);
            cursor: not-allowed;
        }
        
        /* å»ºè®®åˆ—è¡¨æ ·å¼ */
        ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        
        li {
            margin-bottom: 8px;
            position: relative;
        }
        
        li:before {
            content: "â€¢";
            color: var(--primary-color);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }
        
        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-color);
        }

        /* ç¤¾åŒºæ ·å¼ */
        .community-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .community-card {
            border: 1px solid var(--light-gray);
            border-radius: 10px;
            padding: 20px;
            background-color: var(--white);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .community-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .community-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }

        .community-title {
            font-weight: 600;
            font-size: 18px;
            color: var(--secondary-color);
        }

        .community-date {
            color: var(--gray-color);
            font-size: 14px;
        }

        .community-content {
            margin-bottom: 20px;
            line-height: 1.7;
            color: var(--dark-color);
        }

        .community-actions {
            display: flex;
            gap: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .community-action {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
            font-size: 14px;
        }

        .community-action:hover {
            color: var(--primary-color);
        }

        /* ä¸“ä¸šè¿æ¥æ ·å¼ */
        .professional-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .professional-card {
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            background-color: var(--white);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .professional-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .professional-name {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 18px;
        }

        .professional-specialty {
            color: var(--gray-color);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .professional-contact {
            color: var(--gray-color);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .professional-actions {
            display: flex;
            gap: 10px;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background-color: var(--light-color);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tab-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--white);
            font-weight: 500;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--primary-color);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 992px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--light-gray);
            }
        }
         .nav-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .nav-button {
                flex: 1 1 200px;
            }

            .content {
                margin: 15px;
                padding: 20px;
            }

            .record-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .professional-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .small-images {
                grid-template-columns: repeat(2, 1fr);
            }
@media (max-width: 768px) {
            .record-grid {
                grid-template-columns: 1fr;
            }

            .professional-container {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .small-images {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                padding: 15px;
            }

            .content {
                margin: 10px;
                padding: 15px;
            }

            .tab-buttons {
                flex-direction: column;
            }
        }

        /* è¡€ç³–å€¼é¢œè‰²æŒ‡ç¤º */
        .bg-low {
            color: var(--accent-color);
            font-weight: bold;
        }

        .bg-normal {
            color: var(--success-color);
            font-weight: bold;
        }

        .bg-high {
            color: var(--warning-color);
            font-weight: bold;
        }
    </style>
    <style>
        /* AIèŠå¤©æ ·å¼ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
            max-height: 700px;
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--white);
            box-shadow: var(--shadow);
        }

        .chat-header {
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: var(--white);
            border-bottom: 1px solid var(--light-gray);
        }

        .chat-title {
            font-size: 18px;
            font-weight: 600;
        }

        .chat-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            max-width: 80%;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .ai-message {
            align-self: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .user-message .message-avatar {
            background-color: var(--primary-color);
            color: white;
            margin-left: 10px;
        }

        .ai-message .message-avatar {
            background-color: var(--light-gray);
            margin-right: 10px;
        }

        .message-content {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .message-text {
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .user-message .message-text {
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message .message-text {
            background-color: var(--light-gray);
color: var(--dark-color);
            border-bottom-left-radius: 4px;
        }

        .message-time {
font-size: 12px;
color: var(--gray-color);
            margin-top: 4px;
            text-align: right;
        }
        
        .message {
position: relative;
        }
        
        .delete-message-btn {
            position: absolute;
            bottom: 5px;
            right: -30px;
            background: none;
            border: none;
            color: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s, color 0.2s;
            z-index: 5;
            padding: 2px;
            border-radius: 4px;
        }
        
        .message:hover .delete-message-btn {
            opacity: 1;
        }
        
        .delete-message-btn:hover {
            color: var(--accent-color);
            background-color: rgba(255, 255, 255, 0.8);
        }

        .user-message .message-time {
            text-align: right;
        }

        .ai-message .message-time {
            text-align: left;
        }

        .chat-input-container {
            border-top: 1px solid var(--light-gray);
            padding: 15px;
            background-color: var(--light-color);
        }

        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .quick-question {
            padding: 8px 12px;
            background-color: var(--white);
            border: 1px solid var(--light-gray);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-question:hover {
            background-color: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .upload-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 8px;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        #chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 20px;
            resize: none;
            font-size: 15px;
            max-height: 120px;
            transition: var(--transition);
        }

        #chat-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        #send-message {
            padding: 12px 20px;
            border-radius: 20px;
            white-space: nowrap;
        }


        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }

            .quick-questions {
                flex-direction: column;
            }

            .quick-question {
                text-align: center;
            }
        }

        /* æ‰“å­—æŒ‡ç¤ºå™¨ */
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background-color: var(--light-gray);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            max-width: 80px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--gray-color);
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-5px);
            }
        }
    </style>
    <style>
        .resource-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .resource-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        /* èµ„æºè¯¦æƒ…é¡µæ ·å¼ */
        .resource-detail {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .resource-detail h1 {
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .resource-detail .meta {
            color: var(--gray-color);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .resource-detail .content {
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .resource-detail .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            margin-bottom: 20px;
        }

        .resource-detail .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            text-decoration: none;
        }

        .back-button:hover {
            background-color: var(--secondary-color);
        }
    </style>
</head>

<body>
    <!-- ç”¨æˆ·ä¿¡æ¯ç®¡ç†æŒ‰é’® - å³ä¸Šè§’ -->
    <button class="user-management-btn" id="user-management-btn" data-section="user-management">
        <i>ğŸ‘¤</i> ç”¨æˆ·ä¸­å¿ƒ
    </button>

    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    <div class="sidebar">
         <div class="logo">ç³–åŸŸå«å£«<br><span style="font-size: 18px; color: var(--gray-color);">é¢å‘æœªæ¥çš„æŒç»­æ€§è¡€ç³–ç›‘æµ‹ä¸ç”Ÿæ´»æ–¹å¼å¹²é¢„ç³»ç»Ÿ</span>
        </div>
        <div class="nav-buttons">
            <button class="toolbar-button active nav-button" id="home-btn" data-section="home">
                <i>ğŸ </i> é¦–é¡µ
            </button>
            <button class="toolbar-button nav-button" id="data-records-btn" data-section="data-records">
                <i>ğŸ“Š</i> ä¸ªäººæ•°æ®è®°å½•
            </button>
            <button class="toolbar-button nav-button" id="personal-analysis-btn" data-section="personal-analysis">
                <i>ğŸ”</i> AIä¸ªæ€§åŒ–åˆ†æ
            </button>
            <button class="toolbar-button nav-button" id="community-btn" data-section="community">
                <i>ğŸ‘¥</i> ç¤¾åŒºäº’åŠ¨
            </button>
            <button class="toolbar-button nav-button" id="professional-btn" data-section="professional">
                <i>ğŸ¥</i> ä¸“ä¸šè¿æ¥
            </button>
            <button class="toolbar-button nav-button" id="ai-chat-btn" data-section="ai-chat">
                <i>ğŸ¤–</i> AIå¥åº·åŠ©æ‰‹
            </button>
        </div>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <!-- é¦–é¡µ -->
        <div class="content-section active" id="home">
            <h2>ğŸ  æ¬¢è¿ä½¿ç”¨ç³–åŸŸå«å£«</h2>
            <div class="home-container">
                <p>ç³–åŸŸå«å£«æ˜¯ä¸€æ¬¾é¢å‘æœªæ¥çš„æŒç»­æ€§è¡€ç³–ç›‘æµ‹ä¸ç”Ÿæ´»æ–¹å¼å¹²é¢„ç³»ç»Ÿï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç®¡ç†è¡€ç³–å¥åº·ã€‚</p>
                <p>è¯·å…ˆç™»å½•ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½ã€‚</p>
                <div class="large-image">
                    <img src="./images/my-large-image.jpg" alt="è¡€ç³–ç›‘æµ‹">
                </div>
                <div class="small-images">
                    <div class="small-image">
                        <img src="./images/my-small1.jpg" alt="è¡€ç³–æ£€æµ‹è®¾å¤‡">
                    </div>
                    <div class="small-image">
                        <img src="./images/my-small2.jpg" alt="è¡€ç³–ç›‘æµ‹åº”ç”¨">
                    </div>
                    <div class="small-image">
                        <img src="./images/my-small3.jpg" alt="å¥åº·ç”Ÿæ´»æ–¹å¼">
                    </div>
                </div>
            </div>
        </div>

        <!-- ç”¨æˆ·ä¿¡æ¯ç®¡ç† -->
        <div class="content-section" id="user-management">
            <h2>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯ç®¡ç†</h2>
            <div class="user-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="profile">
                        <i>ğŸ“</i> ä¿®æ”¹ä¸ªäººä¿¡æ¯
                    </button>
                    <button class="tab-btn" data-tab="change-password">
                        <i>ğŸ”’</i> ä¿®æ”¹å¯†ç 
                    </button>
                    <button class="tab-btn" data-tab="logout">
                        <i>ğŸšª</i> ç”¨æˆ·æ³¨é”€
                    </button>
                </div>

                <!-- ä¿®æ”¹ä¸ªäººä¿¡æ¯ -->
                <div class="tab-content active" id="profile">
                    <form class="user-form" id="profile-form">
                        <div class="form-group">
                            <label for="current-username">å½“å‰ç”¨æˆ·å</label>
                            <input type="text" id="current-username" readonly>
                        </div>
                        <div class="form-group">
                            <label for="new-username">æ–°ç”¨æˆ·åï¼ˆé€‰å¡«ï¼Œä¸ä¿®æ”¹è¯·ç•™ç©ºï¼‰</label>
                            <input type="text" id="new-username" placeholder="è¯·è¾“å…¥æ–°ç”¨æˆ·å">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-profile">å–æ¶ˆ</button>
                            <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                        </div>
                    </form>
                </div>

                <!-- ä¿®æ”¹å¯†ç  -->
                <div class="tab-content" id="change-password">
                    <form class="user-form" id="change-password-form">
                        <div class="form-group">
                            <label for="old-password">å½“å‰å¯†ç </label>
                            <input type="password" id="old-password" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " required>
                        </div>
                        <div class="form-group">
                            <label for="new-password">æ–°å¯†ç </label>
                            <input type="password" id="new-password" placeholder="è¯·è¾“å…¥æ–°å¯†ç " required>
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">ç¡®è®¤æ–°å¯†ç </label>
                            <input type="password" id="confirm-password" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-password">å–æ¶ˆ</button>
                            <button type="submit" class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
                        </div>
                    </form>
                </div>

                <!-- ç”¨æˆ·æ³¨é”€ -->
                <div class="tab-content" id="logout">
                    <div class="user-form">
                        <p>æ‚¨ç¡®å®šè¦æ³¨é”€å½“å‰è´¦å·å—ï¼Ÿ</p>
                        <div class="form-actions">
                            <button class="tab-btn btn btn-secondary">å–æ¶ˆ</button>
                            <button class="btn btn-primary" id="logout-btn">ç¡®è®¤æ³¨é”€</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸ªäººæ•°æ®è®°å½• -->
        <div class="content-section" id="data-records">
            <h2>ğŸ“Š ä¸ªäººæ•°æ®è®°å½•</h2>
            <div class="data-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="blood-glucose">
                            <i>ğŸ©¸</i> è¡€ç³–è®°å½•
                        </button>
                    <button class="tab-btn" data-tab="diet">
                        <i>ğŸ</i> é¥®é£Ÿè®°å½•
                    </button>
                    <button class="tab-btn" data-tab="exercise">
                        <i>ğŸƒ</i> è¿åŠ¨è®°å½•
                    </button>
                    <button class="tab-btn" data-tab="medication">
                        <i>ğŸ’Š</i> ç”¨è¯è®°å½•
                    </button>
        </div>
        <!-- è¡€ç³–è®°å½• -->
                <div class="tab-content active" id="blood-glucose">
                    <div class="record-form">
                        <h3>æ·»åŠ è¡€ç³–è®°å½•</h3>
                        <form id="bg-form">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="bg-value">è¡€ç³–å€¼ (mg/dL)</label>
                                    <input type="number" id="bg-value" placeholder="ä¾‹å¦‚: 120" min="20" max="600">
                                </div>
                                <div class="form-group">
                                    <label for="bg-time">æµ‹é‡æ—¶é—´</label>
                                    <input type="datetime-local" id="bg-time">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="bg-notes">å¤‡æ³¨</label>
                                <textarea id="bg-notes" rows="2" placeholder="è®°å½•æµ‹é‡æƒ…å†µï¼Œå¦‚é¤å‰/é¤å"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">æ·»åŠ è®°å½•</button>
                            </div>
                        </form>
                    </div>

                    <h3>è¡€ç³–è®°å½•å†å²</h3>
                    <div class="record-grid" id="bg-records">
                        <!-- è¡€ç³–è®°å½•å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>

                <!-- é¥®é£Ÿè®°å½• -->
                <div class="tab-content" id="diet">
                    <div class="record-form">
                        <h3>æ·»åŠ é¥®é£Ÿè®°å½•</h3>
                        <form id="diet-form">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="diet-meal">é¤æ¬¡</label>
                                    <select id="diet-meal">
                                        <option value="breakfast">æ—©é¤</option>
                                        <option value="lunch">åˆé¤</option>
                                        <option value="dinner">æ™šé¤</option>
                                        <option value="snack">åŠ é¤</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="diet-time">ç”¨é¤æ—¶é—´</label>
                                    <input type="datetime-local" id="diet-time">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="diet-content">é¥®é£Ÿå†…å®¹</label>
                                <textarea id="diet-content" rows="3" placeholder="è¯¦ç»†è®°å½•æ‰€åƒçš„é£Ÿç‰©å’Œåˆ†é‡"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="diet-carbs">ç¢³æ°´åŒ–åˆç‰©å«é‡ (g)</label>
                                <input type="number" id="diet-carbs" placeholder="ä¼°ç®—ç¢³æ°´åŒ–åˆç‰©å«é‡">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">æ·»åŠ è®°å½•</button>
                            </div>
                        </form>
                    </div>

                    <h3>é¥®é£Ÿè®°å½•å†å²</h3>
                    <div class="record-grid" id="diet-records">
                        <!-- é¥®é£Ÿè®°å½•å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>

                <!-- è¿åŠ¨è®°å½• -->
                <div class="tab-content" id="exercise">
                    <div class="record-form">
                        <h3>æ·»åŠ è¿åŠ¨è®°å½•</h3>
                        <form id="exercise-form">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="exercise-type">è¿åŠ¨ç±»å‹</label>
                                    <select id="exercise-type">
                                        <option value="walking">æ­¥è¡Œ</option>
                                        <option value="running">è·‘æ­¥</option>
                                        <option value="cycling">éª‘è¡Œ</option>
                                        <option value="swimming">æ¸¸æ³³</option>
                                        <option value="yoga">ç‘œä¼½</option>
                                        <option value="strength">åŠ›é‡è®­ç»ƒ</option>
                                        <option value="other">å…¶ä»–</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="exercise-duration">è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)</label>
                                    <input type="number" id="exercise-duration" placeholder="ä¾‹å¦‚: 30">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="exercise-intensity">è¿åŠ¨å¼ºåº¦</label>
                                    <select id="exercise-intensity">
                                        <option value="light">è½»åº¦</option>
                                        <option value="moderate">ä¸­åº¦</option>
                                        <option value="vigorous">å‰§çƒˆ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="exercise-time">è¿åŠ¨æ—¶é—´</label>
                                    <input type="datetime-local" id="exercise-time">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="exercise-notes">å¤‡æ³¨</label>
                                <textarea id="exercise-notes" rows="2" placeholder="è®°å½•è¿åŠ¨æ„Ÿå—æˆ–å…¶ä»–ä¿¡æ¯"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">æ·»åŠ è®°å½•</button>
                            </div>
                        </form>
                    </div>

                    <h3>è¿åŠ¨è®°å½•å†å²</h3>
                    <div class="record-grid" id="exercise-records">
                        <!-- è¿åŠ¨è®°å½•å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>

                <!-- ç”¨è¯è®°å½• -->
                <div class="tab-content" id="medication">
                    <div class="record-form">
                        <h3>æ·»åŠ ç”¨è¯è®°å½•</h3>
                        <form id="medication-form">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="medication-name">è¯ç‰©åç§°</label>
                                    <input type="text" id="medication-name" placeholder="ä¾‹å¦‚: äºŒç”²åŒèƒ">
                                </div>
                                <div class="form-group">
                                    <label for="medication-dose">å‰‚é‡</label>
                                    <input type="text" id="medication-dose" placeholder="ä¾‹å¦‚: 500mg">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="medication-time">ç”¨è¯æ—¶é—´</label>
                                    <input type="datetime-local" id="medication-time">
                                </div>
                                <div class="form-group">
                                    <label for="medication-frequency">ç”¨è¯é¢‘ç‡</label>
                                    <select id="medication-frequency">
                                        <option value="once">å•æ¬¡</option>
                                        <option value="daily">æ¯æ—¥</option>
                                        <option value="weekly">æ¯å‘¨</option>
                                        <option value="as-needed">æŒ‰éœ€</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="medication-notes">å¤‡æ³¨</label>
                                <textarea id="medication-notes" rows="2" placeholder="è®°å½•ç”¨è¯ååº”æˆ–å…¶ä»–ä¿¡æ¯"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">æ·»åŠ è®°å½•</button>
                            </div>
                        </form>
                    </div>

                    <h3>ç”¨è¯è®°å½•å†å²</h3>
                    <div class="record-grid" id="medication-records">
                        <!-- ç”¨è¯è®°å½•å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>
        </div>


        <!-- ä¸ªæ€§åŒ–åˆ†æ -->
        <div class="content-section" id="personal-analysis">
            <h2>ğŸ” AIä¸ªæ€§åŒ–åˆ†æ</h2>
             <div class="analysis-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="weekly-report">
                        <i>ğŸ“…</i> AIå‘¨æŠ¥
                    </button>
                    <button class="tab-btn" data-tab="monthly-report">
                        <i>ğŸ“Š</i> AIæœˆæŠ¥
                    </button>
                    <button class="tab-btn" data-tab="feedback">
                        <i>ğŸ’¬</i> åé¦ˆæœºåˆ¶
                    </button>
        </div>
        <!-- AIå‘¨æŠ¥ -->
                <div class="tab-content active" id="weekly-report">
                    <!-- åœ¨AIä¸ªæ€§åŒ–åˆ†æéƒ¨åˆ†ï¼Œä¿®å¤å›¾ç‰‡è·¯å¾„ -->
                    <div class="report-container">
                        <!-- ä¿®å¤å›¾ç‰‡è·¯å¾„ -->
                        <img src="images/blood-sugar-trend.jpg" alt="è¡€ç³–è¶‹åŠ¿å›¾" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
                        <!-- æˆ–è€…ä½¿ç”¨base64ç¼–ç çš„å ä½å›¾ç‰‡ -->
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWKoOi9veWbvuWDj+W5suWHuuWPsyDlm77lg488L3RleHQ+Cjwvc3ZnPg==" alt="è¡€ç³–è¶‹åŠ¿å›¾å ä½ç¬¦" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
                    </div>
                    </div>
                    <div class="report-content">
                        <p>æœ¬å‘¨æ‚¨çš„å¹³å‡è¡€ç³–å€¼ä¸º <span class="bg-normal">128 mg/dL</span>ï¼Œå¤„äºç†æƒ³èŒƒå›´å†…ã€‚</p>
                        <p>ä¸ä¸Šå‘¨ç›¸æ¯”ï¼Œæ‚¨çš„è¡€ç³–ç¨³å®šæ€§æœ‰æ‰€æé«˜ï¼Œæ³¢åŠ¨èŒƒå›´ç¼©å°äº†15%ã€‚</p>
                                <p>å»ºè®®ï¼šç»§ç»­ä¿æŒè‰¯å¥½çš„é¥®é£Ÿå’Œè¿åŠ¨ä¹ æƒ¯ï¼Œæ³¨æ„ç›‘æµ‹é¤åè¡€ç³–ã€‚</p>
                            </div>
                            <div class="report-actions">
                                <div class="report-action">
                                    <i>ğŸ“¥</i> ä¸‹è½½æŠ¥å‘Š
                                </div>
                                <div class="report-action">
                                    <i>ğŸ–¨ï¸</i> æ‰“å°æŠ¥å‘Š
                                </div>
                            </div>
                        </div>

                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">ç”Ÿæ´»æ–¹å¼åˆ†æ</div>
                                <div class="report-date">2023å¹´6æœˆç¬¬3å‘¨</div>
                            </div>
                            <div class="chart-container">
                                <image src="./image/blood-sugar-trend.jpg"></image>
                            </div>
                            <div class="report-content">
                                <p>æœ¬å‘¨æ‚¨å…±è¿›è¡Œäº†5æ¬¡è¿åŠ¨ï¼Œæ€»æ—¶é•¿210åˆ†é’Ÿï¼Œè¾¾æ ‡ç‡85%ã€‚</p>
                                <p>é¥®é£Ÿæ–¹é¢ï¼Œç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡æ§åˆ¶è‰¯å¥½ï¼Œä½†å»ºè®®å¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥ã€‚</p>
                                <p>ç¡çœ è´¨é‡è¯„ä¼°ï¼šå¹³å‡ç¡çœ æ—¶é•¿7.2å°æ—¶ï¼Œè´¨é‡è‰¯å¥½ã€‚</p>
                            </div>
                            <div class="report-actions">
                                <div class="report-action">
                                    <i>ğŸ“¥</i> ä¸‹è½½æŠ¥å‘Š
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AIæœˆæŠ¥ -->
                <div class="tab-content" id="monthly-report">
                    <div class="report-container">
                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">è¡€ç³–æ§åˆ¶æœˆæŠ¥</div>
                                <div class="report-date">2023å¹´6æœˆ</div>
                            </div>
                            <div class="chart-container">
                                <p>æœˆåº¦è¡€ç³–è¶‹åŠ¿å›¾è¡¨åŒºåŸŸ</p>
                            </div>
                            <div class="report-content">
                                <p>æœ¬æœˆæ‚¨çš„å¹³å‡è¡€ç³–å€¼ä¸º <span class="bg-normal">132 mg/dL</span>ï¼Œç³–åŒ–è¡€çº¢è›‹ç™½ä¼°ç®—å€¼ä¸º6.8%ã€‚</p>
                                <p>ä¸ä¸Šæœˆç›¸æ¯”ï¼Œæ‚¨çš„è¡€ç³–æ§åˆ¶æœ‰æ˜¾è‘—æ”¹å–„ï¼Œå¹³å‡è¡€ç³–å€¼ä¸‹é™äº†12 mg/dLã€‚</p>
                                <p>æœ¬æœˆå…±è®°å½•è¡€ç³–æµ‹é‡82æ¬¡ï¼Œè¾¾æ ‡ç‡78%ï¼Œè¾ƒä¸Šæœˆæé«˜10%ã€‚</p>
                            </div>
                            <div class="report-actions">
                                <div class="report-action">
                                    <i>ğŸ“¥</i> ä¸‹è½½æŠ¥å‘Š
                                </div>
                                <div class="report-action">
                                    <i>ğŸ–¨ï¸</i> æ‰“å°æŠ¥å‘Š
                                </div>
                            </div>
                        </div>

                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">ç»¼åˆå¥åº·æœˆæŠ¥</div>
                                <div class="report-date">2023å¹´6æœˆ</div>
                            </div>
                            <div class="chart-container">
                                <p>ç»¼åˆå¥åº·æŒ‡æ ‡å›¾è¡¨åŒºåŸŸ</p>
                            </div>
                            <div class="report-content">
                                <p>æœ¬æœˆä½“é‡å˜åŒ–ï¼š-1.2kgï¼ŒBMIä»26.8é™è‡³26.3ã€‚</p>
                                <p>è¿åŠ¨æ€»é‡ï¼šå…±è¿›è¡Œ22æ¬¡è¿åŠ¨ï¼Œæ€»æ—¶é•¿890åˆ†é’Ÿã€‚</p>
                                <p>é¥®é£Ÿåˆ†æï¼šå¹³å‡æ¯æ—¥ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…ã€‚</p>
                                <p>ç”¨è¯ä¾ä»æ€§ï¼š98%ï¼Œè¡¨ç°ä¼˜ç§€ã€‚</p>
                            </div>
                            <div class="report-actions">
                                <div class="report-action">
                                    <i>ğŸ“¥</i> ä¸‹è½½æŠ¥å‘Š
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åé¦ˆæœºåˆ¶ -->
                <div class="tab-content" id="feedback">
                    <div class="report-container">
                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">ç³»ç»Ÿåé¦ˆä¸å»ºè®®</div>
                                <div class="report-date">æœ€è¿‘æ›´æ–°: 2023-06-20</div>
                            </div>
                            <div class="report-content">
                                <p>æ ¹æ®æ‚¨çš„æ•°æ®è®°å½•å’Œåˆ†æï¼Œç³»ç»Ÿä¸ºæ‚¨æä¾›ä»¥ä¸‹ä¸ªæ€§åŒ–å»ºè®®ï¼š</p>
                                <ul style="margin: 15px 0; padding-left: 20px;">
                                    <li>å¢åŠ æ—©é¤å30åˆ†é’Ÿçš„è½»åº¦æ´»åŠ¨ï¼Œæœ‰åŠ©äºæ§åˆ¶é¤åè¡€ç³–å‡é«˜</li>
                                    <li>è€ƒè™‘å°†æ™šé¤ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡å‡å°‘10-15å…‹</li>
                                    <li>æœ¬å‘¨ä¸‰ä¸‹åˆçš„è¡€ç³–å€¼å¼‚å¸¸å‡é«˜ï¼Œå¯èƒ½ä¸å½“å¤©çš„é¥®é£Ÿæœ‰å…³ï¼Œå»ºè®®å›é¡¾è®°å½•</li>
                                    <li>æ‚¨çš„è¿åŠ¨ä¹ æƒ¯è‰¯å¥½ï¼Œç»§ç»­ä¿æŒæ¯å‘¨è‡³å°‘150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦è¿åŠ¨</li>
                                </ul>
                                <p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–éœ€è¦è°ƒæ•´å»ºè®®ï¼Œè¯·éšæ—¶è”ç³»æ‚¨çš„å¥åº·ç®¡ç†å¸ˆã€‚</p>
                            </div>
                        </div>

                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">æä¾›åé¦ˆ</div>
                            </div>
                            <div class="report-content">
                                <form>
                                    <div class="form-group">
                                        <label for="feedback-type">åé¦ˆç±»å‹</label>
                                        <select id="feedback-type">
                                            <option value="suggestion">å»ºè®®</option>
                                            <option value="question">ç–‘é—®</option>
                                            <option value="problem">é—®é¢˜æŠ¥å‘Š</option>
                                            <option value="praise">è¡¨æ‰¬</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="feedback-content">åé¦ˆå†…å®¹</label>
                                        <textarea id="feedback-content" rows="5" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„åé¦ˆå†…å®¹"></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">æäº¤åé¦ˆ</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- ç¤¾åŒºäº’åŠ¨ -->
        <div class="content-section" id="community">
            <h2>ğŸ‘¥ ç¤¾åŒºäº’åŠ¨</h2>
           <div class="community-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="forum">
                        <i>ğŸ’¬</i> äº¤æµè®ºå›
                    </button>
                    <button class="tab-btn" data-tab="experience">
                        <i>ğŸ“</i> ç»éªŒåˆ†äº«
                    </button>
                    <button class="tab-btn" data-tab="activities">
                        <i>ğŸ‰</i> ç¤¾åŒºæ´»åŠ¨
                    </button>
                    <button class="tab-btn" data-tab="publish">
                        <i>âœï¸</i> å‘å¸ƒèµ„è®¯
                    </button>
                    <button class="tab-btn" data-tab="manage">
                        <i>âš™ï¸</i> èµ„è®¯ç®¡ç†
                    </button>
        </div>

         <!-- äº¤æµè®ºå› -->
                <div class="tab-content active" id="forum">
                    <div class="search-box" style="margin-bottom: 20px;">
                        <div class="form-group" style="max-width: 400px;">
                            <input type="text" id="forum-search" placeholder="æœç´¢å¸–å­æ ‡é¢˜æˆ–å†…å®¹..."
                                style="width: 100%; padding: 10px;">
                        </div>
                    </div>
                    <div class="community-container">
                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">å¦‚ä½•åº”å¯¹æ¸…æ™¨é«˜è¡€ç³–ï¼Ÿ</div>
                                <div class="community-date">2023-06-18</div>
                            </div>
                            <div class="community-content">
                                æœ€è¿‘å‘ç°æ—©æ™¨ç©ºè…¹è¡€ç³–æ€»æ˜¯åé«˜ï¼Œå³ä½¿æ™šé¤åƒå¾—å¾ˆå°‘ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æœ‰æ²¡æœ‰ç³–å‹æœ‰ç±»ä¼¼ç»éªŒï¼Ÿå¦‚ä½•æœ‰æ•ˆåº”å¯¹æ¸…æ™¨é«˜è¡€ç³–ç°è±¡ï¼Ÿ
                            </div>
                            <div class="community-actions">
                                <div class="community-action like-btn" data-post-id="1">
                                    <i>ğŸ‘</i> ç‚¹èµ (<span class="like-count">24</span>)
                                </div>
                                <div class="community-action comment-btn" data-post-id="1">
                                    <i>ğŸ’¬</i> è¯„è®º (<span class="comment-count">15</span>)
                                </div>
                                <div class="community-action favorite-btn" data-post-id="1">
                                    <i>â­</i> æ”¶è—
                                </div>
                            </div>
                        </div>

                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">åˆ†äº«æˆ‘çš„ä½ç¢³æ°´é£Ÿè°±</div>
                                <div class="community-date">2023-06-15</div>
                            </div>
                            <div class="community-content">
                                ç¡®è¯Šç³–å°¿ç—…ä¸¤å¹´ï¼Œé€šè¿‡è°ƒæ•´é¥®é£ŸæˆåŠŸå°†ç³–åŒ–è¡€çº¢è›‹ç™½ä»8.5%é™è‡³6.2%ã€‚ä»Šå¤©åˆ†äº«å‡ æ¬¾æˆ‘å¸¸åšçš„ä½ç¢³æ°´é£Ÿè°±ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼
                            </div>
                            <div class="community-actions">
                                <div class="community-action like-btn" data-post-id="1">
                                    <i>ğŸ‘</i> ç‚¹èµ (<span class="like-count">24</span>)
                                </div>
                                <div class="community-action comment-btn" data-post-id="1">
                                    <i>ğŸ’¬</i> è¯„è®º (<span class="comment-count">15</span>)
                                </div>
                                <div class="community-action favorite-btn" data-post-id="1">
                                    <i>â­</i> æ”¶è—
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç»éªŒåˆ†äº« -->
                <div class="tab-content" id="experience">
                    <div class="community-container">
                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">æˆ‘çš„è¿åŠ¨æ§ç³–ç»éªŒ</div>
                                <div class="community-date">2023-06-10</div>
                            </div>
                            <div class="community-content">
                                ä½œä¸ºä¸€å2å‹ç³–å°¿ç—…æ‚£è€…ï¼Œæˆ‘å‘ç°è§„å¾‹è¿åŠ¨å¯¹è¡€ç³–æ§åˆ¶éå¸¸é‡è¦ã€‚æˆ‘æ¯å¤©åšæŒæ­¥è¡Œ30åˆ†é’Ÿï¼Œé¤åç®€å•æ´»åŠ¨ï¼Œè¡€ç³–ç¨³å®šæ€§æ˜æ˜¾æé«˜ã€‚
                            </div>
                            <div class="community-actions">
                                <div class="community-action like-btn" data-post-id="1">
                                    <i>ğŸ‘</i> ç‚¹èµ (<span class="like-count">24</span>)
                                </div>
                                <div class="community-action comment-btn" data-post-id="1">
                                    <i>ğŸ’¬</i> è¯„è®º (<span class="comment-count">15</span>)
                                </div>
                                <div class="community-action favorite-btn" data-post-id="1">
                                    <i>â­</i> æ”¶è—
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç¤¾åŒºæ´»åŠ¨ -->
                <div class="tab-content" id="activities">
                    <div class="community-container">
                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">çº¿ä¸Šç³–å°¿ç—…çŸ¥è¯†è®²åº§</div>
                                <div class="community-date">2023-06-25 19:00</div>
                            </div>
                            <div class="community-content">
                                <p>æœ¬æœŸè®²åº§ä¸»é¢˜ï¼š"ç³–å°¿ç—…é¥®é£Ÿç®¡ç†çš„ç§‘å­¦ä¸å®è·µ"ï¼Œç‰¹é‚€å†…åˆ†æ³Œç§‘ä¸»ä»»åŒ»å¸ˆç‹åŒ»ç”Ÿä¸»è®²ã€‚æ¬¢è¿å„ä½ç³–å‹å‚åŠ ï¼</p>
                                <div style="display: flex; gap: 10px; margin: 10px 0;">
                                    <span
                                        style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; font-size: 12px;">ä¸“å®¶è®²åº§</span>
                                    <span
                                        style="background: #f3e5f5; color: #7b1fa2; padding: 4px 8px; border-radius: 4px; font-size: 12px;">çº¿ä¸Šæ´»åŠ¨</span>
                                </div>
                                <div
                                    style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; color: #666;">
                                    <span>å·²æŠ¥å 114äºº</span>
                                    <span>å‰©ä½™åé¢ 43äºº</span>
                                </div>
                            </div>
                            <div class="community-actions">
                                <div class="community-action join-btn" data-activity-id="1">
                                    <i>âœ…</i> <span class="join-text">æŠ¥åå‚åŠ </span>
                                </div>
                            </div>
                        </div>
                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">çº¿ä¸Šä¸“å®¶è®²åº§ï¼šç³–å°¿ç—…æœ€æ–°æ²»ç–—è¿›å±•</div>
                                <div class="community-date">2023-06-25 19:00-21:00</div>
                            </div>
                            <div class="community-content">
                                <p>é‚€è¯·åŒ—äº¬åå’ŒåŒ»é™¢å†…åˆ†æ³Œç§‘å¼ æ•™æˆä¸ºå¤§å®¶è®²è§£ç³–å°¿ç—…çš„æœ€æ–°æ²»ç–—è¿›å±•ï¼ŒåŒ…æ‹¬æ–°å‹é™ç³–è¯ç‰©ã€èƒ°å²›ç´ æ²»ç–—çš„æ–°æ–¹æ¡ˆç­‰ã€‚æ¬¢è¿å¤§å®¶åœ¨çº¿å‚ä¸å¹¶æé—®ã€‚</p>
                                <div style="display: flex; gap: 10px; margin: 10px 0;">
                                    <span
                                        style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; font-size: 12px;">ä¸“å®¶è®²åº§</span>
                                    <span
                                        style="background: #f3e5f5; color: #7b1fa2; padding: 4px 8px; border-radius: 4px; font-size: 12px;">çº¿ä¸Šæ´»åŠ¨</span>
                                </div>
                                <div
                                    style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; color: #666;">
                                    <span>å·²æŠ¥å 234äºº</span>
                                    <span>å‰©ä½™åé¢ 66äºº</span>
                                </div>
                            </div>
                            <div class="community-actions">
                                <div class="community-action join-btn" data-activity-id="2"
                                    data-activity-title="çº¿ä¸Šä¸“å®¶è®²åº§ï¼šç³–å°¿ç—…æœ€æ–°æ²»ç–—è¿›å±•">
                                    <i>âœ…</i> <span class="join-text">ç«‹å³æŠ¥å</span>
                                </div>
                            </div>
                        </div>
                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">ç¤¾åŒºå¥æ­¥èµ°æ´»åŠ¨ï¼šä¸ç³–å‹ä¸€èµ·æ‹¥æŠ±å¥åº·</div>
                                <div class="community-date">2023-07-01 09:00-12:00</div>
                            </div>
                            <div class="community-content">
                                <p>ç»„ç»‡ç¤¾åŒºç³–å‹ä¸€èµ·è¿›è¡Œå¥æ­¥èµ°æ´»åŠ¨ï¼Œè·¯çº¿ä¸ºåŸå¸‚ä¸­å¤®å…¬å›­ç¯çº¿ï¼Œå…¨ç¨‹5å…¬é‡Œã€‚æ´»åŠ¨ç»“æŸåæœ‰ä¸“ä¸šåŒ»ç”Ÿæä¾›å…è´¹è¡€ç³–æ£€æµ‹å’Œå¥åº·å’¨è¯¢æœåŠ¡ã€‚</p>
                                <div style="display: flex; gap: 10px; margin: 10px 0;">
                                    <span
                                        style="background: #e8f5e8; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-size: 12px;">æˆ·å¤–æ´»åŠ¨</span>
                                    <span
                                        style="background: #fff3e0; color: #ef6c00; padding: 4px 8px; border-radius: 4px; font-size: 12px;">ç¤¾åŒºæ´»åŠ¨</span>
                                </div>
                                <div
                                    style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; color: #666;">
                                    <span>å·²æŠ¥å 156äºº</span>
                                    <span>å‰©ä½™åé¢ 44äºº</span>
                                </div>
                            </div>
                            <div class="community-actions">
                                <div class="community-action join-btn" data-activity-id="3"
                                    data-activity-title="ç¤¾åŒºå¥æ­¥èµ°æ´»åŠ¨ï¼šä¸ç³–å‹ä¸€èµ·æ‹¥æŠ±å¥åº·">
                                    <i>âœ…</i> <span class="join-text">ç«‹å³æŠ¥å</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‘å¸ƒèµ„è®¯ -->
                <div class="tab-content" id="publish">
                    <form class="user-form">
                        <div class="form-group">
                            <label for="news-title">èµ„è®¯æ ‡é¢˜</label>
                            <input type="text" id="news-title" placeholder="è¯·è¾“å…¥èµ„è®¯æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label for="news-content">èµ„è®¯å†…å®¹</label>
                            <textarea id="news-content" rows="10" placeholder="è¯·è¾“å…¥èµ„è®¯å†…å®¹"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="news-tags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                            <input type="text" id="news-tags" placeholder="ä¾‹å¦‚ï¼šé¥®é£Ÿç®¡ç†,è¿åŠ¨å»ºè®®,ç”¨è¯ç»éªŒ">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">å‘å¸ƒèµ„è®¯</button>
                        </div>
                    </form>
                </div>

                <!-- èµ„è®¯ç®¡ç† -->
                <div class="tab-content" id="manage">
                    <div class="community-container">
                        <div class="community-card">
                            <div class="community-header">
                                <div class="community-title">æˆ‘å‘å¸ƒçš„èµ„è®¯ï¼šç³–å°¿ç—…ç›‘æµ‹æ–°è®¾å¤‡ä»‹ç»</div>
                                <div class="community-date">2023-06-12</div>
                            </div>
                            <div class="community-actions">
                                <div class="community-action">
                                    <i>ğŸ‘</i> ç‚¹èµ (31)
                                </div>
                                <div class="community-action">
                                    <i>ğŸ’¬</i> è¯„è®º (12)
                                </div>
                                <div class="community-action">
                                    <i>âœï¸</i> ç¼–è¾‘
                                </div>
                                <div class="community-action">
                                    <i>ğŸ—‘ï¸</i> åˆ é™¤
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
         <!-- ä¸“ä¸šè¿æ¥ -->
        <div class="content-section" id="professional">
            <h2>ğŸ¥ ä¸“ä¸šè¿æ¥</h2>
            <div class="professional-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="doctor-communication">
                        <i>ğŸ‘¨â€âš•ï¸</i> åŒ»ç”Ÿæ²Ÿé€š
                    </button>
                    <button class="tab-btn" data-tab="family-binding">
                        <i>ğŸ‘ª</i> å®¶äººç»‘å®š
                    </button>
                    <button class="tab-btn" data-tab="health-resources">
                        <i>ğŸ“š</i> å¥åº·èµ„æº
                    </button>
                </div>

                <!-- åŒ»ç”Ÿæ²Ÿé€š -->
                <div class="tab-content active" id="doctor-communication">
                    <div class="professional-container">
                        <div class="professional-card">
                            <div class="professional-name">ç‹åŒ»ç”Ÿ</div>
                            <div class="professional-specialty">å†…åˆ†æ³Œç§‘ä¸»ä»»åŒ»å¸ˆ</div>
                            <div class="professional-contact">åŒ»é™¢ï¼šå¸‚ç¬¬ä¸€äººæ°‘åŒ»é™¢</div>
                            <div class="professional-contact">ä¸“é•¿ï¼šç³–å°¿ç—…åŠå…¶å¹¶å‘ç—‡</div>
                            <div class="professional-actions">
                                <button class="btn btn-primary consult-btn" data-doctor-id="1" data-doctor-name="ç‹åŒ»ç”Ÿ"
                                    data-doctor-specialty="å†…åˆ†æ³Œç§‘ä¸»ä»»åŒ»å¸ˆ">åœ¨çº¿å’¨è¯¢</button>
                                <button class="btn btn-secondary appointment-btn" data-doctor-id="1"
                                    data-doctor-name="ç‹åŒ»ç”Ÿ" data-doctor-specialty="å†…åˆ†æ³Œç§‘ä¸»ä»»åŒ»å¸ˆ">é¢„çº¦å°±è¯Š</button>
                            </div>
                        </div>

                        <div class="professional-card">
                            <div class="professional-name">æåŒ»ç”Ÿ</div>
                            <div class="professional-specialty">è¥å…»ç§‘ä¸»æ²»åŒ»å¸ˆ</div>
                            <div class="professional-contact">åŒ»é™¢ï¼šå¸‚ä¸­åŒ»åŒ»é™¢</div>
                            <div class="professional-contact">ä¸“é•¿ï¼šç³–å°¿ç—…é¥®é£Ÿç®¡ç†</div>
                            <div class="professional-actions">
                                <button class="btn btn-primary consult-btn" data-doctor-id="1" data-doctor-name="ç‹åŒ»ç”Ÿ"
                                    data-doctor-specialty="å†…åˆ†æ³Œç§‘ä¸»ä»»åŒ»å¸ˆ">åœ¨çº¿å’¨è¯¢</button>
                                <button class="btn btn-secondary appointment-btn" data-doctor-id="1"
                                    data-doctor-name="ç‹åŒ»ç”Ÿ" data-doctor-specialty="å†…åˆ†æ³Œç§‘ä¸»ä»»åŒ»å¸ˆ">é¢„çº¦å°±è¯Š</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å®¶äººç»‘å®š -->
                <div class="tab-content" id="family-binding">
                    <div class="user-form">
                        <h3>ç»‘å®šå®¶äººè´¦å·</h3>
                        <form>
                            <div class="form-group">
                                <label for="family-relation">å®¶äººå…³ç³»</label>
                                <select id="family-relation">
                                    <option value="spouse">é…å¶</option>
                                    <option value="child">å­å¥³</option>
                                    <option value="parent">çˆ¶æ¯</option>
                                    <option value="sibling">å…„å¼Ÿå§å¦¹</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="family-name">å®¶äººå§“å</label>
                                <input type="text" id="family-name" placeholder="è¯·è¾“å…¥å®¶äººå§“å">
                            </div>
                            <div class="form-group">
                                <label for="family-phone">æ‰‹æœºå·ç </label>
                                <input type="tel" id="family-phone" placeholder="è¯·è¾“å…¥å®¶äººæ‰‹æœºå·ç ">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">å‘é€ç»‘å®šé‚€è¯·</button>
                            </div>
                        </form>
                    </div>

                    <h3>å·²ç»‘å®šçš„å®¶äºº</h3>
                    <div class="professional-container">
                        <div class="professional-card">
                            <div class="professional-name">å¼ å°æ˜</div>
                            <div class="professional-specialty">å„¿å­</div>
                            <div class="professional-contact">ç»‘å®šæ—¶é—´ï¼š2023-05-10</div>
                            <div class="professional-actions">
                                <button class="btn btn-secondary">å–æ¶ˆç»‘å®š</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¥åº·èµ„æº -->
                <div class="tab-content" id="health-resources">
                    <div class="professional-container">
                        <!-- æ–‡ç« èµ„æº -->
                        <div class="professional-card resource-card" data-resource-id="article-1"
                            data-resource-type="article">
                            <a href="#article-1" class="resource-link">
                                <div class="professional-name">ç³–å°¿ç—…é¥®é£ŸæŒ‡å—</div>
                                <div class="professional-specialty">æ–‡ç« </div>
                                <div class="professional-contact">å‘å¸ƒæ—¶é—´ï¼š2023-06-01</div>
                                <div class="professional-actions">
                                    <button class="btn btn-primary">é˜…è¯»å…¨æ–‡</button>
                                </div>
                            </a>
                        </div>

                        <!-- è§†é¢‘èµ„æº -->
                        <div class="professional-card resource-card" data-resource-id="video-1"
                            data-resource-type="video">
                            <a href="#video-1" class="resource-link">
                                <div class="professional-name">é€‚åˆç³–å°¿ç—…æ‚£è€…çš„è¿åŠ¨è§†é¢‘</div>
                                <div class="professional-specialty">è§†é¢‘</div>
                                <div class="professional-contact">æ—¶é•¿ï¼š15åˆ†é’Ÿ</div>
                                <div class="professional-actions">
                                    <button class="btn btn-primary">è§‚çœ‹è§†é¢‘</button>
                                </div>
                            </a>
                        </div>

                        <!-- çŸ¥è¯†å¡ç‰‡èµ„æº -->
                        <div class="professional-card resource-card" data-resource-id="card-1"
                            data-resource-type="card">
                            <a href="#card-1" class="resource-link">
                                <div class="professional-name">è¡€ç³–ç›‘æµ‹å°çŸ¥è¯†</div>
                                <div class="professional-specialty">çŸ¥è¯†å¡ç‰‡</div>
                                <div class="professional-contact">ç³»åˆ—ï¼šå…±12æœŸ</div>
                                <div class="professional-actions">
                                    <button class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</button>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <div id="resource-detail-container" style="display: none;"></div>
            </div>
        </div>

        <!-- AIå¥åº·åŠ©æ‰‹ -->
        <div class="content-section" id="ai-chat">
            <h2>ğŸ¤– AIå¥åº·åŠ©æ‰‹</h2>
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title">ç³–åŸŸAIå¥åº·åŠ©æ‰‹</div>
                    <div class="chat-subtitle">éšæ—¶ä¸ºæ‚¨è§£ç­”ç³–å°¿ç—…ç›¸å…³é—®é¢˜</div>
                </div>
                 <div class="chat-messages" id="chat-messages">
                    <!-- åˆå§‹æ¬¢è¿æ¶ˆæ¯ -->
                    <div class="message ai-message">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            <div class="message-text">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯ç³–åŸŸAIå¥åº·åŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨è§£ç­”å…³äºç³–å°¿ç—…ç®¡ç†ã€é¥®é£Ÿå»ºè®®ã€è¿åŠ¨æŒ‡å¯¼ç­‰æ–¹é¢çš„é—®é¢˜ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
                            </div>
                            <div class="message-time">åˆšåˆš</div>
                        </div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <button id="image-upload-btn" class="upload-btn" title="ä¸Šä¼ å›¾ç‰‡">ğŸ“·</button>
                        <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
                        <textarea id="chat-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." rows="1"></textarea>
                        <button id="send-message" class="btn btn-primary">
                            <i>ğŸ“¤</i> å‘é€
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="recordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ç¼–è¾‘è®°å½•</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-record-form">
                    <div class="form-group">
                        <label for="edit-record-value">æ•°å€¼</label>
                        <input type="text" id="edit-record-value">
                    </div>
                    <div class="form-group">
                        <label for="edit-record-notes">å¤‡æ³¨</label>
                        <textarea id="edit-record-notes" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-edit">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="commentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">å‘è¡¨è¯„è®º</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="comment-form">
                    <div class="form-group">
                        <label for="comment-content">è¯„è®ºå†…å®¹</label>
                        <textarea id="comment-content" rows="4" placeholder="è¯·è¾“å…¥æ‚¨çš„è¯„è®º..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-comment">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">å‘è¡¨è¯„è®º</button>
                    </div>
                </form>

                <div id="comments-list"
                    style="margin-top: 20px; border-top: 1px solid var(--light-gray); padding-top: 15px;">
                    <h4>å·²æœ‰è¯„è®º</h4>
                    <div id="comments-container">
                        <!-- è¯„è®ºå°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- åŒ»ç”Ÿå’¨è¯¢æ¨¡æ€æ¡† -->
    <div class="modal" id="consultModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="consult-title">åœ¨çº¿å’¨è¯¢</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="consult-form">
                    <div class="form-group">
                        <label for="consult-doctor">å’¨è¯¢åŒ»ç”Ÿ</label>
                        <input type="text" id="consult-doctor" readonly>
                    </div>
                    <div class="form-group">
                        <label for="consult-subject">å’¨è¯¢ä¸»é¢˜</label>
                        <input type="text" id="consult-subject" placeholder="è¯·è¾“å…¥å’¨è¯¢ä¸»é¢˜">
                    </div>
                    <div class="form-group">
                        <label for="consult-content">è¯¦ç»†æè¿°</label>
                        <textarea id="consult-content" rows="5" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„ç—‡çŠ¶æˆ–é—®é¢˜..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="consult-urgency">ç´§æ€¥ç¨‹åº¦</label>
                        <select id="consult-urgency">
                            <option value="normal">ä¸€èˆ¬</option>
                            <option value="urgent">ç´§æ€¥</option>
                            <option value="very-urgent">éå¸¸ç´§æ€¥</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-consult">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æäº¤å’¨è¯¢</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- é¢„çº¦å°±è¯Šæ¨¡æ€æ¡† -->
    <div class="modal" id="appointmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="appointment-title">é¢„çº¦å°±è¯Š</div>
                <button class="modal-close">&times;</button>
</div>
            <div class="modal-body">
                <form id="appointment-form">
                    <div class="form-group">
                        <label for="appointment-doctor">å°±è¯ŠåŒ»ç”Ÿ</label>
                        <input type="text" id="appointment-doctor" readonly>
                    </div>
                    <div class="form-group">
                        <label for="appointment-date">é¢„çº¦æ—¥æœŸ</label>
                        <input type="date" id="appointment-date">
                    </div>
                    <div class="form-group">
                        <label for="appointment-time">é¢„çº¦æ—¶é—´</label>
                        <select id="appointment-time">
                            <option value="">è¯·é€‰æ‹©æ—¶é—´æ®µ</option>
                            <option value="08:00-09:00">08:00-09:00</option>
                            <option value="09:00-10:00">09:00-10:00</option>
                            <option value="10:00-11:00">10:00-11:00</option>
                            <option value="14:00-15:00">14:00-15:00</option>
                            <option value="15:00-16:00">15:00-16:00</option>
<option value="16:00-17:00">16:00-17:00</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="appointment-reason">å°±è¯ŠåŸå› </label>
                        <textarea id="appointment-reason" rows="3" placeholder="è¯·ç®€è¦æè¿°å°±è¯ŠåŸå› "></textarea>
                    </div>
                    <div class="form-group">
                        <label for="appointment-phone">è”ç³»ç”µè¯</label>
                        <input type="tel" id="appointment-phone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-appointment">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ç¡®è®¤é¢„çº¦</button>
                    </div>
                </form>
            </div>
        </div>
</div>


    <!-- ç™»å½•çŠ¶æ€ç®¡ç†å’Œæƒé™æ§åˆ¶ -->
    <script>
        // æ˜¾ç¤ºæŒ‡å®šåŒºåŸŸ
        function showSection(sectionId) {
            // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // å–æ¶ˆæ‰€æœ‰å¯¼èˆªæŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.toolbar-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹åŒºåŸŸ
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // æ¿€æ´»å¯¹åº”çš„å¯¼èˆªæŒ‰é’®
            const targetButton = document.querySelector(`.toolbar-button[data-section="${sectionId}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // ç‰¹æ®Šå¤„ç†æ•°æ®è®°å½•æ¨¡å—ï¼Œç¡®ä¿åˆ‡æ¢åˆ°è¯¥æ¨¡å—æ—¶èƒ½è‡ªåŠ¨æ¸²æŸ“è¡€ç³–è®°å½•
            if (sectionId === 'data-records') {
                // ç¡®ä¿è¡€ç³–è®°å½•æ ‡ç­¾å¤„äºæ¿€æ´»çŠ¶æ€
                const bloodSugarTab = document.querySelector('.data-tabs .tab-btn[data-tab="blood-glucose"]');
                if (bloodSugarTab) {
                    // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„activeç±»
                    document.querySelectorAll('.data-tabs .tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    // ç»™è¡€ç³–è®°å½•æ ‡ç­¾æ·»åŠ activeç±»
                    bloodSugarTab.classList.add('active');
                    
                    // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
                    document.querySelectorAll('.data-tabs .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    // æ˜¾ç¤ºè¡€ç³–è®°å½•å†…å®¹
                    const bloodSugarContent = document.getElementById('blood-glucose');
                    if (bloodSugarContent) {
                        bloodSugarContent.classList.add('active');
                        // æ¸²æŸ“è¡€ç³–è®°å½•æ•°æ®
                        renderRecords('blood-glucose');
                    }
                }
            }
            
            // ç‰¹æ®Šå¤„ç†ç”¨æˆ·ä¸­å¿ƒæ¨¡å—ï¼Œé»˜è®¤æ˜¾ç¤ºä¸ªäººä¿¡æ¯æ ‡ç­¾
            if (sectionId === 'user-management') {
                // ç¡®ä¿ä¸ªäººä¿¡æ¯æ ‡ç­¾å¤„äºæ¿€æ´»çŠ¶æ€
                const profileTab = document.querySelector('.user-tabs .tab-btn[data-tab="profile"]');
                if (profileTab) {
                    // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„activeç±»
                    document.querySelectorAll('.user-tabs .tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    // ç»™ä¸ªäººä¿¡æ¯æ ‡ç­¾æ·»åŠ activeç±»
                    profileTab.classList.add('active');
                    
                    // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
                    document.querySelectorAll('.user-tabs .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    // æ˜¾ç¤ºä¸ªäººä¿¡æ¯å†…å®¹
                    const profileContent = document.getElementById('profile');
                    if (profileContent) {
                        profileContent.classList.add('active');
                    }
                }
            }
            
            // ç¡®ä¿å…¶ä»–æ¨¡å—åˆ‡æ¢æ—¶ä¹Ÿèƒ½æ­£ç¡®åˆå§‹åŒ–
            if (sectionId === 'personal-analysis' || sectionId === 'community' || sectionId === 'professional') {
                // ç¡®ä¿ç¬¬ä¸€ä¸ªæ ‡ç­¾å¤„äºæ¿€æ´»çŠ¶æ€
                const firstTab = document.querySelector(`#${sectionId} .tab-btn`);
                if (firstTab && !firstTab.classList.contains('active')) {
                    firstTab.click();
                }
            }
        }
        
        // ä¿å­˜æ•°æ®åˆ°localStorageçš„å‡½æ•°
            function saveSampleData() {
                try {
                    localStorage.setItem('tangyuSampleData', JSON.stringify(window.sampleData));
                } catch (e) {
                    console.error('ä¿å­˜æ•°æ®åˆ°localStorageå¤±è´¥:', e);
                }
            }
            
            // åˆå§‹åŒ–å…¨å±€æ•°æ®å¯¹è±¡
            function initSampleData() {
                // å°è¯•ä»localStorageåŠ è½½æ•°æ®
                try {
                    const savedData = localStorage.getItem('tangyuSampleData');
                    if (savedData) {
                        window.sampleData = JSON.parse(savedData);
                        console.log('ä»localStorageåŠ è½½æ•°æ®æˆåŠŸ');
                        return;
                    }
                } catch (e) {
                    console.error('ä»localStorageåŠ è½½æ•°æ®å¤±è´¥:', e);
                }
                
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®æˆ–åŠ è½½å¤±è´¥ï¼Œåˆå§‹åŒ–é»˜è®¤æ•°æ®
                console.log('åˆå§‹åŒ–é»˜è®¤æ•°æ®');
                window.sampleData = {
                    bloodglucose: [
                        { id: '1', value: '120', time: '2023-06-15T08:00', notes: 'ç©ºè…¹è¡€ç³–' },
                        { id: '2', value: '150', time: '2023-06-15T12:30', notes: 'é¤å2å°æ—¶' },
                        { id: '3', value: '130', time: '2023-06-15T18:00', notes: 'æ™šé¤å‰' },
                        { id: '4', value: '160', time: '2023-06-16T08:00', notes: 'ç©ºè…¹è¡€ç³–' },
                        { id: '5', value: '140', time: '2023-06-16T12:30', notes: 'é¤å2å°æ—¶' },
                        { id: '6', value: '125', time: '2023-06-16T18:00', notes: 'æ™šé¤å‰' }
                    ],
                    diet: [],
                    exercise: [],
                    medication: [],
                    forumPosts: [],
                    activities: []
                };
            }
            
            // ç™»å½•çŠ¶æ€ç®¡ç†
            function isLoggedIn() {
                try {
                    const userData = localStorage.getItem('currentUser');
                    console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€:', userData ? 'å·²ç™»å½•' : 'æœªç™»å½•');
                    return userData !== null;
                } catch (error) {
                    console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
                    return false;
                }
            }

            function login(userData) {
                try {
                    console.log('è®¾ç½®ç™»å½•ç”¨æˆ·æ•°æ®:', userData);
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    updateUIForLogin();
                    console.log('UIå·²æ›´æ–°ä¸ºç™»å½•çŠ¶æ€');
                } catch (error) {
                    console.error('ç™»å½•å¤±è´¥:', error);
                    alert('ç™»å½•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                }
            }

            function logout() {
                localStorage.removeItem('currentUser');
                updateUIForLogout();
            }

            function updateUIForLogin() {
                // æ˜¾ç¤ºç™»å½•åçš„ç”¨æˆ·ä¿¡æ¯
                const userData = JSON.parse(localStorage.getItem('currentUser'));
                const userBtn = document.getElementById('user-management-btn');
                if (userBtn) {
                    userBtn.innerHTML = `<i>ğŸ‘¤</i> ${userData.username || 'ç”¨æˆ·ä¸­å¿ƒ'}`;
                }
                
                // å¯ç”¨æ‰€æœ‰åŠŸèƒ½æ¨¡å—
                document.querySelectorAll('.nav-button').forEach(el => {
                    el.classList.remove('disabled');
                });
                
                // å¡«å……ä¸ªäººä¿¡æ¯è¡¨å•
                populateProfileForm();
            }

            function updateUIForLogout() {
                // é‡ç½®ç”¨æˆ·æŒ‰é’®
                const userBtn = document.getElementById('user-management-btn');
                if (userBtn) {
                    userBtn.innerHTML = '<i>ğŸ‘¤</i> ç”¨æˆ·ä¸­å¿ƒ';
                }
                
                // ç¦ç”¨éé¦–é¡µåŠŸèƒ½æ¨¡å—
                document.querySelectorAll('.nav-button').forEach(btn => {
                    if (btn.id !== 'home-btn') {
                        btn.classList.add('disabled');
                    }
                });
                
                // æ˜¾ç¤ºé¦–é¡µå†…å®¹
                showSection('home');
            }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
            document.addEventListener('DOMContentLoaded', function() {
                console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–æ•°æ®');
                
                // åˆå§‹åŒ–å…¨å±€æ•°æ®å¯¹è±¡å¹¶ä»localStorageåŠ è½½æ•°æ®
                initSampleData();
                
                // ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜
                window.addEventListener('beforeunload', saveSampleData);
                // å®šæœŸä¿å­˜æ•°æ®
                setInterval(saveSampleData, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€');
            
            // ç”±äºæˆ‘ä»¬åœ¨é¡µé¢é¡¶éƒ¨å·²ç»æ·»åŠ äº†é‡å®šå‘é€»è¾‘ï¼Œè¿™é‡Œä¸å†éœ€è¦é¢å¤–æç¤º
            
            // å¢å¼ºå®‰å…¨ï¼šæ¯æ¬¡ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨ç™»å‡º
            window.addEventListener('beforeunload', function() {
                // æ¸…é™¤ç™»å½•çŠ¶æ€
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                console.log('ä¼šè¯ç»“æŸï¼Œç”¨æˆ·ç™»å½•çŠ¶æ€å·²æ¸…é™¤');
            });
            
            // ä¸ºå¯¼èˆªæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.toolbar-button, .user-management-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    if (sectionId) {
                        // å¼ºåˆ¶ç™»å½•æ£€æŸ¥ - ç”±äºé¡µé¢é¡¶éƒ¨å·²æœ‰é‡å®šå‘ï¼Œè¿™é‡Œæ˜¯é¢å¤–ä¿éšœ
                        if (!isLoggedIn()) {
                            console.log('æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢');
                            window.location.href = 'simple_login.html';
                            return;
                        }
                        showSection(sectionId);
                    }
                });
            });

            // ä¸ºæ ‡ç­¾æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
                    document.querySelectorAll('.tab-btn').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
                    const targetContent = document.getElementById(tabId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                    
                    // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®
                    this.classList.add('active');
                });
            });

            // å¡«å……ä¸ªäººä¿¡æ¯è¡¨å• - ä¿®å¤ï¼šç§»åˆ°å…¨å±€ä½œç”¨åŸŸ
            function populateProfileForm() {
                const userData = JSON.parse(localStorage.getItem('currentUser'));
                if (userData) {
                    const currentUsernameInput = document.getElementById('current-username');
                    if (currentUsernameInput) {
                        currentUsernameInput.value = userData.username || '';
                    }
                }
            }

            // æ£€æŸ¥åˆå§‹ç™»å½•çŠ¶æ€
            if (isLoggedIn()) {
                updateUIForLogin();
            } else {
                updateUIForLogout();
            }

            // ä¸ºä¸ªäººä¿¡æ¯ä¿®æ”¹è¡¨å•æ·»åŠ äº‹ä»¶ç›‘å¬
            const profileForm = document.getElementById('profile-form');
            if (profileForm) {
                profileForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const newUsername = document.getElementById('new-username').value;
                    
                    // å¦‚æœæ²¡æœ‰è¾“å…¥æ–°ç”¨æˆ·åï¼Œä¸æ‰§è¡Œä¿®æ”¹
                    if (!newUsername.trim()) {
                        alert('è¯·è¾“å…¥æ–°ç”¨æˆ·åæˆ–å–æ¶ˆæ“ä½œ');
                        return;
                    }

                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        const submitBtn = this.querySelector('button[type="submit"]');
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'ä¿å­˜ä¸­...';
                        
                        // è·å–å½“å‰ç”¨æˆ·æ•°æ®
                        let userData = JSON.parse(localStorage.getItem('currentUser'));
                        
                        // æ›´æ–°ç”¨æˆ·å
                        userData.username = newUsername;
                        
                        // ä¿å­˜æ›´æ–°åçš„ç”¨æˆ·æ•°æ®
                        localStorage.setItem('currentUser', JSON.stringify(userData));
                        
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        alert('ç”¨æˆ·åä¿®æ”¹æˆåŠŸï¼');
                        
                        // æ›´æ–°UI
                        updateUIForLogin();
                        
                        // æ¸…ç©ºè¡¨å•
                        document.getElementById('new-username').value = '';
                    } catch (error) {
                        console.error('ä¿®æ”¹ç”¨æˆ·åå¤±è´¥:', error);
                        alert('ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•');
                    } finally {
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ä¿å­˜ä¿®æ”¹';
                    }
                });
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶
                document.getElementById('cancel-profile').addEventListener('click', function() {
                    document.getElementById('new-username').value = '';
                });
            }

            // ä¸ºå¯†ç ä¿®æ”¹è¡¨å•æ·»åŠ äº‹ä»¶ç›‘å¬
            const changePasswordForm = document.getElementById('change-password-form');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const oldPassword = document.getElementById('old-password').value;
                    const newPassword = document.getElementById('new-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;
                    
                    // ç®€å•çš„å®¢æˆ·ç«¯éªŒè¯
                    if (!oldPassword || !newPassword || !confirmPassword) {
                        alert('è¯·å¡«å†™æ‰€æœ‰å¯†ç å­—æ®µ');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        alert('æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸ä¸€è‡´');
                        return;
                    }

                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        const submitBtn = this.querySelector('button[type="submit"]');
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'ä¿®æ”¹ä¸­...';
                        
                        // è¿™é‡Œå¯ä»¥æ·»åŠ ä¸åç«¯APIçš„äº¤äº’
                        // ç›®å‰ä½¿ç”¨å‰ç«¯æ¨¡æ‹Ÿ
                        console.log('ä¿®æ”¹å¯†ç è¯·æ±‚:', { oldPassword, newPassword });
                        
                        // æ¨¡æ‹Ÿå¯†ç ä¿®æ”¹æˆåŠŸ
                        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯API
                        
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼è¯·é‡æ–°ç™»å½•');
                        
                        // æ¸…ç©ºè¡¨å•
                        this.reset();
                        
                        // å¯é€‰ï¼šä¿®æ”¹å¯†ç åè‡ªåŠ¨æ³¨é”€å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
                        // logout();
                        // window.location.href = 'simple_login.html';
                    } catch (error) {
                        console.error('ä¿®æ”¹å¯†ç å¤±è´¥:', error);
                        alert('ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•');
                    } finally {
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ä¿®æ”¹å¯†ç ';
                    }
                });
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶
                document.getElementById('cancel-password').addEventListener('click', function() {
                    changePasswordForm.reset();
                });
            }

            // æ·»åŠ æ³¨é”€åŠŸèƒ½
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        logout();
                        alert('å·²é€€å‡ºç™»å½•');
                    }
                });
            }
          });
        
        // ç”¨æˆ·ç®¡ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelector('.user-management-btn').addEventListener('click', function () {
            // å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œå…è®¸è®¿é—®ç”¨æˆ·ç®¡ç†é¡µé¢
            showSection('user-management');
        });

        // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
        function setupTabSwitching(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const tabId = this.getAttribute('data-tab');

                    // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                    container.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    // ç»™å½“å‰æŒ‰é’®æ·»åŠ activeç±»
                    this.classList.add('active');

                    // éšè—æ‰€æœ‰å†…å®¹
                    container.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
                    document.getElementById(tabId).classList.add('active');

                    // å¦‚æœæ˜¯æ•°æ®è®°å½•æ ‡ç­¾ï¼Œæ¸²æŸ“ç›¸åº”æ•°æ®
                    if (containerId === 'data-records') {
                        renderRecords(tabId);
                    }
                    
                    // ç‰¹åˆ«å¤„ç†ä¸“ä¸šè¿æ¥æ ‡ç­¾é¡µï¼Œç¡®ä¿å¥åº·èµ„æºè¯¦æƒ…é¡µæ­£ç¡®éšè—
                    if (containerId === 'professional') {
                        // éšè—èµ„æºè¯¦æƒ…é¡µï¼ˆå¦‚æœæ‰“å¼€ï¼‰
                        const detailContainer = document.getElementById('resource-detail-container');
                        if (detailContainer) {
                            detailContainer.style.display = 'none';
                        }
                        
                        // ç¡®ä¿æ‰€æœ‰æ ‡ç­¾å†…å®¹éƒ½æ­£ç¡®æ˜¾ç¤º/éšè—
                        container.querySelectorAll('.tab-content').forEach(content => {
                            if (content.id === tabId) {
                                content.style.display = 'block';
                            } else {
                                content.style.display = 'none';
                            }
                        });
                    }
                });
            });
        }

        // åˆå§‹åŒ–æ‰€æœ‰æ ‡ç­¾é¡µ
        setupTabSwitching('user-management');
        setupTabSwitching('data-records');
        setupTabSwitching('personal-analysis');
        setupTabSwitching('community');
        setupTabSwitching('professional');
        
        // ç¡®ä¿AIä¸ªæ€§åŒ–åˆ†æåŒºåŸŸæ­£ç¡®åŠ è½½åˆå§‹æŠ¥å‘Š
        function checkAndLoadAIReport() {
            const currentUserId = 'current_user';
            const personalAnalysis = document.getElementById('personal-analysis');
            const weeklyReport = document.getElementById('weekly-report');
            
            if (personalAnalysis && personalAnalysis.classList.contains('active') && weeklyReport) {
                const reportContent = weeklyReport.querySelector('.report-container');
                
                // å¢å¼ºçš„é—®é¢˜æ£€æµ‹é€»è¾‘ï¼šæ£€æŸ¥å†…å®¹æ˜¯å¦ä¸ºç©ºã€åªåŒ…å«å›¾ç‰‡æˆ–æ˜¾ç¤ºå¼‚å¸¸
                const hasProblem = reportContent && (
                    reportContent.innerHTML.trim() === '' || 
                    reportContent.innerHTML.trim() === '<img>' ||
                    reportContent.innerHTML.trim().includes('<img') ||
                    reportContent.innerHTML.trim().length < 50 // å†…å®¹è¿‡çŸ­è¡¨ç¤ºå¼‚å¸¸
                );
                
                if (hasProblem) {
                    console.log('æ£€æµ‹åˆ°åˆå§‹åŠ è½½é—®é¢˜ï¼Œé‡æ–°åŠ è½½æŠ¥å‘Š...');
                    // å¼ºåˆ¶æ¸…ç©ºå†…å®¹å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    reportContent.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 24px; margin-bottom: 10px;">ğŸ”„</div><div>æ­£åœ¨ç”Ÿæˆå‘¨æŠ¥...</div></div>';
                    // ç«‹å³åŠ è½½æŠ¥å‘Š
                    loadAIReport(currentUserId, 'week');
                } else if (reportContent) {
                    console.log('æŠ¥å‘Šå·²æˆåŠŸåŠ è½½');
                }
            }
        }
        
        // å¢å¼ºçš„æ£€æŸ¥æœºåˆ¶ï¼šå¤šé‡æ—¶é—´ç‚¹æ£€æŸ¥
        const checkIntervals = [100, 300, 500, 800, 1000]; // å¤šä¸ªæ—¶é—´ç‚¹æ£€æŸ¥
        checkIntervals.forEach(interval => {
            setTimeout(checkAndLoadAIReport, interval);
        });
        
        // ç›‘å¬DOMContentLoadedäº‹ä»¶ï¼Œç¡®ä¿åœ¨DOMå®Œå…¨åŠ è½½åå†æ£€æŸ¥ä¸€æ¬¡
        document.addEventListener('DOMContentLoaded', function() {
            // é¡µé¢å®Œå…¨åŠ è½½åå†è¿›è¡Œå¤šæ¬¡æ£€æŸ¥
            const domCheckIntervals = [100, 300, 500];
            domCheckIntervals.forEach(interval => {
                setTimeout(checkAndLoadAIReport, interval);
            });
        });

        // æ¸²æŸ“è®°å½•æ•°æ®
        function renderRecords(type) {
            console.log('æ¸²æŸ“è®°å½•ç±»å‹:', type);
            
            // ç¡®ä¿window.sampleDataå¯¹è±¡å·²åˆå§‹åŒ–
            if (typeof window.sampleData === 'undefined') {
                console.error('window.sampleDataæœªå®šä¹‰ï¼Œé‡æ–°åˆå§‹åŒ–');
                initSampleData();
            }
            
            // å¤„ç†å‘½åä¸ä¸€è‡´é—®é¢˜ï¼šç¡®ä¿èƒ½æ­£ç¡®è®¿é—®è¡€ç³–æ•°æ®
            let recordType;
            if (type === 'blood-glucose') {
                recordType = 'bloodglucose'; // æ•°æ®ç»“æ„ä¸­çš„é”®å
            } else {
                recordType = type.replace('-', ''); // å…¶ä»–ç±»å‹ä½¿ç”¨å¸¸è§„è½¬æ¢
            }
            console.log('è®°å½•ç±»å‹å¤„ç†å:', recordType);
            
            // ç¡®ä¿è¯¥è®°å½•ç±»å‹çš„æ•°æ®ç»“æ„å­˜åœ¨
            if (typeof window.sampleData[recordType] === 'undefined') {
                window.sampleData[recordType] = [];
            }

            // æ ¹æ®ä¸åŒçš„è®°å½•ç±»å‹ä½¿ç”¨æ­£ç¡®çš„å®¹å™¨ID
            let containerId;
            if (type === 'blood-glucose') {
                containerId = 'bg-records';
            } else {
                containerId = `${type}-records`;
            }
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            const records = window.sampleData[recordType] || [];

            if (records.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">æš‚æ— è®°å½•æ•°æ®</p>';
                return;
            }

            records.forEach(record => {
                const card = document.createElement('div');
                card.className = 'record-card';
                card.setAttribute('data-id', record.id);

                let valueDisplay = '';
                if (type === 'blood-glucose') {
                    let bgClass = 'bg-normal';
                    if (record.value < 70) bgClass = 'bg-low';
                    else if (record.value > 180) bgClass = 'bg-high';
                    valueDisplay = `<div class="record-value ${bgClass}">${record.value} mg/dL</div>`;
                } else if (type === 'diet') {
                    valueDisplay = `<div class="record-value">ç¢³æ°´åŒ–åˆç‰©: ${record.carbs}g</div>`;
                } else if (type === 'exercise') {
                    valueDisplay = `<div class="record-value">${record.duration}åˆ†é’Ÿ</div>`;
                } else if (type === 'medication') {
                    valueDisplay = `<div class="record-value">${record.dose}</div>`;
                }

                card.innerHTML = `
                    <div class="record-header">
                        <div class="record-type">${getRecordTypeDisplay(type, record)}</div>
                        <div class="record-date">${formatDate(record.time)}</div>
                    </div>
                    ${valueDisplay}
                    <div class="record-notes">${record.notes || 'æ— å¤‡æ³¨'}</div>
                    <div class="record-actions">
                        <button class="record-btn edit">ç¼–è¾‘</button>
                        <button class="record-btn delete">åˆ é™¤</button>
                    </div>
                `;

                container.appendChild(card);
            });

            // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤äº‹ä»¶
            container.querySelectorAll('.record-btn.edit').forEach(btn => {
                btn.addEventListener('click', function () {
                    const card = this.closest('.record-card');
                    const recordId = card.getAttribute('data-id');
                    openEditModal(type, recordId);
                });
            });

            container.querySelectorAll('.record-btn.delete').forEach(btn => {
                btn.addEventListener('click', function () {
                    const card = this.closest('.record-card');
                    const recordId = card.getAttribute('data-id');
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                        // æ›´æ–°æ¨¡æ‹Ÿæ•°æ®
                        let recordType;
                        if (type === 'blood-glucose') {
                            recordType = 'bloodglucose';
                        } else {
                            recordType = type.replace('-', '');
                        }
                        const index = window.sampleData[recordType].findIndex(r => r.id == recordId);
                        if (index !== -1) {
                            window.sampleData[recordType].splice(index, 1);
                            
                            // ä¿å­˜æ•°æ®åˆ°localStorage
                            saveSampleData();
                            
                            // ç§»é™¤å¡ç‰‡
                            card.remove();
                            
                            // å¦‚æœæ²¡æœ‰è®°å½•äº†ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                            if (window.sampleData[recordType].length === 0) {
                                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">æš‚æ— è®°å½•æ•°æ®</p>';
                            }
                            
                            // æ˜¾ç¤ºæˆåŠŸæç¤º
                            alert('è®°å½•åˆ é™¤æˆåŠŸï¼');
                        }
                    }
                });
            });
        }

        // è·å–è®°å½•ç±»å‹æ˜¾ç¤ºæ–‡æœ¬
        function getRecordTypeDisplay(type, record) {
            const typeMap = {
                'blood-glucose': 'è¡€ç³–è®°å½•',
                'diet': {
                    'breakfast': 'æ—©é¤',
                    'lunch': 'åˆé¤',
                    'dinner': 'æ™šé¤',
                    'snack': 'åŠ é¤'
                }[record.meal] || 'é¥®é£Ÿè®°å½•',
                'exercise': {
                    'walking': 'æ­¥è¡Œ',
                    'running': 'è·‘æ­¥',
                    'cycling': 'éª‘è¡Œ',
                    'swimming': 'æ¸¸æ³³',
                    'yoga': 'ç‘œä¼½',
                    'strength': 'åŠ›é‡è®­ç»ƒ',
                    'other': 'å…¶ä»–è¿åŠ¨'
                }[record.type] || 'è¿åŠ¨è®°å½•',
                'medication': 'ç”¨è¯è®°å½•'
            };

            return typeof typeMap === 'string' ? typeMap : typeMap[type];
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        }

        // æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
        function openEditModal(type, recordId) {
            // å¤„ç†å‘½åä¸ä¸€è‡´é—®é¢˜ï¼šç¡®ä¿èƒ½æ­£ç¡®è®¿é—®è¡€ç³–æ•°æ®
            let recordType;
            if (type === 'blood-glucose') {
                recordType = 'bloodglucose'; // æ•°æ®ç»“æ„ä¸­çš„é”®å
            } else {
                recordType = type.replace('-', ''); // å…¶ä»–ç±»å‹ä½¿ç”¨å¸¸è§„è½¬æ¢
            }
            const record = window.sampleData[recordType].find(r => r.id == recordId);
            if (!record) return;

            document.getElementById('edit-record-value').value = record.value || '';
            document.getElementById('edit-record-notes').value = record.notes || '';

            document.getElementById('recordModal').classList.add('active');

            // ä¿å­˜ä¿®æ”¹
            document.getElementById('edit-record-form').onsubmit = function (e) {
                e.preventDefault();
                record.notes = document.getElementById('edit-record-notes').value;
                if (record.value !== undefined) {
                    record.value = document.getElementById('edit-record-value').value;
                }
                
                // ä¿å­˜æ•°æ®åˆ°localStorage
                saveSampleData();
                
                document.getElementById('recordModal').classList.remove('active');
                renderRecords(type); // é‡æ–°æ¸²æŸ“
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                alert('è®°å½•æ›´æ–°æˆåŠŸï¼');
            };
        }

        // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
        document.getElementById('cancel-edit').addEventListener('click', function () {
            document.getElementById('recordModal').classList.remove('active');
        });

        // å…³é—­æ¨¡æ€æ¡†
        document.querySelectorAll('.modal-close').forEach(button => {
            button.addEventListener('click', function () {
                this.closest('.modal').classList.remove('active');
            });
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function (e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
          });
        });

        // è¡¨å•æäº¤å¤„ç†
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const formId = this.id;
                
                // å¤„ç†æ•°æ®è®°å½•è¡¨å•
                if (formId && formId.includes('-form') && !formId.includes('edit')) {
                    let recordType, newRecord;
                    
                    // æ ¹æ®è¡¨å•ç±»å‹åˆ›å»ºæ–°è®°å½•
                    if (formId === 'bg-form') {
                        // è¡€ç³–è®°å½•
                        const value = document.getElementById('bg-value').value;
                        const time = document.getElementById('bg-time').value;
                        const notes = document.getElementById('bg-notes').value;
                        
                        if (!value || !time) {
                            alert('è¯·å¡«å†™è¡€ç³–å€¼å’Œæµ‹é‡æ—¶é—´');
                            return;
                        }
                        
                        recordType = 'blood-glucose';
                        newRecord = {
                            id: Date.now().toString(),
                            value: value,
                            time: time,
                            notes: notes
                        };
                    } else if (formId === 'diet-form') {
                        // é¥®é£Ÿè®°å½•
                        const meal = document.getElementById('diet-meal').value;
                        const carbs = document.getElementById('diet-carbs').value;
                        const time = document.getElementById('diet-time').value;
                        const content = document.getElementById('diet-content').value;
                         
                        if (!meal || !carbs || !time || !content) {
                            alert('è¯·å¡«å†™å®Œæ•´çš„é¥®é£Ÿè®°å½•ä¿¡æ¯');
                            return;
                        }
                         
                        recordType = 'diet';
                        newRecord = {
                            id: Date.now().toString(),
                            meal: meal,
                            carbs: carbs,
                            time: time,
                            content: content
                        };
                    } else if (formId === 'exercise-form') {
                        // è¿åŠ¨è®°å½•
                        const type = document.getElementById('exercise-type').value;
                        const duration = document.getElementById('exercise-duration').value;
                        const time = document.getElementById('exercise-time').value;
                        const notes = document.getElementById('exercise-notes').value;
                        
                        if (!type || !duration || !time) {
                            alert('è¯·å¡«å†™å®Œæ•´çš„è¿åŠ¨è®°å½•ä¿¡æ¯');
                            return;
                        }
                        
                        recordType = 'exercise';
                        newRecord = {
                            id: Date.now().toString(),
                            type: type,
                            duration: duration,
                            time: time,
                            notes: notes
                        };
                    } else if (formId === 'medication-form') {
                        // ç”¨è¯è®°å½•
                        const name = document.getElementById('medication-name').value;
                        const dose = document.getElementById('medication-dose').value;
                        const time = document.getElementById('medication-time').value;
                        const notes = document.getElementById('medication-notes').value;
                        
                        if (!name || !dose || !time) {
                            alert('è¯·å¡«å†™å®Œæ•´çš„ç”¨è¯è®°å½•ä¿¡æ¯');
                            return;
                        }
                        
                        recordType = 'medication';
                        newRecord = {
                            id: Date.now().toString(),
                            name: name,
                            dose: dose,
                            time: time,
                            notes: notes
                        };
                    }
                    
                    // å°†æ–°è®°å½•æ·»åŠ åˆ°æ•°æ®ä¸­
                    if (recordType && newRecord) {
                        let dataKey;
                        if (recordType === 'blood-glucose') {
                            dataKey = 'bloodglucose';
                        } else {
                            dataKey = recordType.replace('-', '');
                        }
                        
                        // ç¡®ä¿æ•°æ®æ•°ç»„å·²åˆå§‹åŒ–
                        if (!window.sampleData[dataKey]) {
                            window.sampleData[dataKey] = [];
                        }
                        
                        // æ·»åŠ æ–°è®°å½•
                        window.sampleData[dataKey].push(newRecord);
                        
                        // ä¿å­˜æ•°æ®åˆ°localStorage
                        saveSampleData();
                        
                        // é‡ç½®è¡¨å•
                        this.reset();
                        
                        // é‡æ–°æ¸²æŸ“è®°å½•
                        renderRecords(recordType);
                        
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        alert('è®°å½•æ·»åŠ æˆåŠŸï¼');
                    }
                } else if (formId === 'login-form' || formId === 'register-form') {
                    // å¤„ç†ç™»å½•å’Œæ³¨å†Œè¡¨å•ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
                    alert('æ“ä½œæˆåŠŸï¼ï¼ˆæ¼”ç¤ºåŠŸèƒ½ï¼‰');
                    this.reset();
                }
            });
        });

        // åˆå§‹åŒ–é¡µé¢æ—¶æ¸²æŸ“è¡€ç³–è®°å½•
        document.addEventListener('DOMContentLoaded', function () {
            renderRecords('blood-glucose');
        });
        // è®ºå›æœç´¢åŠŸèƒ½
        document.getElementById('forum-search').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase();
            const posts = document.querySelectorAll('.community-card');

            posts.forEach(post => {
                const title = post.querySelector('.community-title').textContent.toLowerCase();
                const content = post.querySelector('.community-content').textContent.toLowerCase();

                if (title.includes(searchTerm) || content.includes(searchTerm)) {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            });
        });

        // ç‚¹èµåŠŸèƒ½
        document.addEventListener('click', function (e) {
            if (e.target.closest('.like-btn')) {
                const btn = e.target.closest('.like-btn');
                const postId = btn.getAttribute('data-post-id');
                const likeCount = btn.querySelector('.like-count');

                // æ¨¡æ‹Ÿç‚¹èµæ“ä½œ
                let currentLikes = parseInt(likeCount.textContent);
                likeCount.textContent = currentLikes + 1;

                // æ›´æ–°æ¨¡æ‹Ÿæ•°æ®
                const post = window.sampleData.forumPosts.find(p => p.id == postId);
                if (post) post.likes++;

                // æ·»åŠ è§†è§‰åé¦ˆ
                btn.style.color = 'var(--primary-color)';
                setTimeout(() => {
                    btn.style.color = '';
                }, 1000);
            }
        });

        // è¯„è®ºåŠŸèƒ½
        document.addEventListener('click', function (e) {
            if (e.target.closest('.comment-btn')) {
                const btn = e.target.closest('.comment-btn');
                const postId = btn.getAttribute('data-post-id');
                openCommentModal(postId);
            }
        });

        function openCommentModal(postId) {
            // ä¿å­˜å½“å‰å¸–å­ID
            window.currentPostId = postId;

            // æ‰“å¼€æ¨¡æ€æ¡†
            document.getElementById('commentModal').classList.add('active');

            // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
            if (!isLoggedIn()) {
                showToast('è¯·å…ˆç™»å½•');
                return;
            }

            // åŠ è½½è¯„è®ºåˆ—è¡¨
            refreshCommentsList(postId);

            // è¯„è®ºè¡¨å•æäº¤
            document.getElementById('comment-form').onsubmit = function (e) {
                e.preventDefault();
                const content = document.getElementById('comment-content').value.trim();

                if (content && postId) {
                    addComment(postId, content);
                }
            };
        }

        // æ´»åŠ¨æŠ¥ååŠŸèƒ½
        document.addEventListener('click', function (e) {
            if (e.target.closest('.join-btn')) {
                const btn = e.target.closest('.join-btn');
                const activityId = btn.getAttribute('data-activity-id');
                const joinText = btn.querySelector('.join-text');
                const activity = window.sampleData.activities.find(a => a.id == activityId);

                if (activity && !activity.joined) {
                    activity.joined = true;
                    joinText.textContent = 'å·²æŠ¥å';
                    btn.style.color = 'var(--success-color)';
                    alert('æŠ¥åæˆåŠŸï¼');
                } else if (activity && activity.joined) {
                    activity.joined = false;
                    joinText.textContent = 'æŠ¥åå‚åŠ ';
                    btn.style.color = '';
                    alert('å·²å–æ¶ˆæŠ¥åï¼');
                }
            }
        });

        // ä¸“ä¸šè¿æ¥åŠŸèƒ½
        document.addEventListener('click', function (e) {
            if (e.target.closest('.btn-primary') || e.target.closest('.btn-secondary')) {
                const btn = e.target.closest('.btn');
                const card = btn.closest('.professional-card');
                const doctorName = card.querySelector('.professional-name').textContent;

                if (btn.textContent.includes('å’¨è¯¢')) {
                    alert(`å³å°†è·³è½¬åˆ°ä¸${doctorName}çš„åœ¨çº¿å’¨è¯¢é¡µé¢`);
                } else if (btn.textContent.includes('é¢„çº¦')) {
                    alert(`å³å°†è·³è½¬åˆ°${doctorName}çš„é¢„çº¦é¡µé¢`);
                } else if (btn.textContent.includes('é˜…è¯»') || btn.textContent.includes('è§‚çœ‹') || btn.textContent.includes('æŸ¥çœ‹')) {
                    const resourceName = card.querySelector('.professional-name').textContent;
                    alert(`å³å°†æ‰“å¼€ï¼š${resourceName}`);
                }
            }
        });

        // å…³é—­è¯„è®ºæ¨¡æ€æ¡†
        document.getElementById('cancel-comment').addEventListener('click', function () {
            document.getElementById('commentModal').classList.remove('active');
        });

        // åˆå§‹åŒ–å‘å¸ƒèµ„è®¯åŠŸèƒ½
        function initPublishNewsFeature() {
            const publishForm = document.querySelector('#publish form');
            if (publishForm) {
                publishForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
                    if (!isLoggedIn()) {
                        showToast('è¯·å…ˆç™»å½•');
                        return;
                    }
                    
                    const title = document.getElementById('news-title').value.trim();
                    const content = document.getElementById('news-content').value.trim();
                    const tagsInput = document.getElementById('news-tags').value.trim();
                    // å°†æ ‡ç­¾å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„
                    const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];
                    
                    if (!title || !content) {
                        showToast('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
                        return;
                    }
                    
                    try {
                        const userId = getCurrentUserId();
                        const newsId = publishForm.getAttribute('data-news-id');
                        const submitBtn = document.querySelector('#publish form button[type="submit"]');
                        
                        if (newsId) {
                            // æ›´æ–°èµ„è®¯
                            const updateResult = await window.apiClient.updateNews(newsId, userId, title, content, tags);
                            
                            // æ£€æŸ¥APIè¿”å›çš„successçŠ¶æ€
                            if (!updateResult.success) {
                                throw new Error('APIè¿”å›å¤±è´¥çŠ¶æ€');
                            }
                            
                            // é‡ç½®è¡¨å•çŠ¶æ€
                            publishForm.removeAttribute('data-news-id');
                            submitBtn.textContent = 'å‘å¸ƒèµ„è®¯';
                            
                            showToast('èµ„è®¯æ›´æ–°æˆåŠŸï¼');
                        } else {
                            // å‘å¸ƒæ–°èµ„è®¯
                            const publishResult = await window.apiClient.publishNews(userId, title, content, tags);
                            
                            // æ£€æŸ¥APIè¿”å›çš„successçŠ¶æ€
                            if (!publishResult.success) {
                                throw new Error('APIè¿”å›å¤±è´¥çŠ¶æ€');
                            }
                            
                            showToast('èµ„è®¯å‘å¸ƒæˆåŠŸï¼');
                        }
                        
                        // é‡ç½®è¡¨å•
                        publishForm.reset();
                        
                        // å¦‚æœå½“å‰åœ¨èµ„è®¯ç®¡ç†é¡µé¢ï¼Œåˆ·æ–°é¡µé¢
                        if (document.querySelector('#manage').classList.contains('active')) {
                            loadUserNews();
                        }
                        // å¦‚æœå½“å‰åœ¨å‘å¸ƒé¡µé¢ï¼Œåˆ‡æ¢åˆ°ç®¡ç†é¡µé¢æŸ¥çœ‹ç»“æœ
                        else if (document.querySelector('#publish').classList.contains('active')) {
                            const manageTabBtn = document.querySelector('.tab-btn[data-tab="manage"]');
                            if (manageTabBtn) {
                                manageTabBtn.click();
                            }
                        }
                    } catch (error) {
                        console.error('Failed to handle news:', error);
                        showToast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                });
            }
        }
        
        // åˆå§‹åŒ–èµ„è®¯ç®¡ç†åŠŸèƒ½
        function initNewsManagementFeature() {
            // ç›‘å¬æ ‡ç­¾é¡µåˆ‡æ¢
            document.addEventListener('click', function(e) {
                if (e.target.closest('.tab-btn[data-tab="manage"]')) {
                    loadUserNews();
                }
            });
        }
        
        // åŠ è½½ç”¨æˆ·å‘å¸ƒçš„èµ„è®¯
        async function loadUserNews() {
            try {
                // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
                if (!isLoggedIn()) return;
                
                const userId = getCurrentUserId();
                const newsResult = await window.apiClient.getUserNews(userId);
                const newsList = newsResult.data || [];
                
                const manageContainer = document.querySelector('#manage .community-container');
                if (!manageContainer) return;
                
                if (newsList.length === 0) {
                    manageContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 40px 0;">æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•èµ„è®¯</p>';
                    return;
                }
                
                manageContainer.innerHTML = '';
                
                newsList.forEach(news => {
                    const newsCard = document.createElement('div');
                    newsCard.className = 'community-card';
                    newsCard.setAttribute('data-news-id', news.id);
                    newsCard.innerHTML = `
                        <div class="community-header">
                            <div class="community-title">${news.title}</div>
                            <div class="community-date">${formatDate(news.publishedAt)}</div>
                        </div>
                        <div class="community-content">
                            <p>${truncateText(news.content, 100)}</p>
                            <div style="display: flex; gap: 10px; margin: 10px 0;">
                                ${news.tags.map(tag => `
                                    <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${tag}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="community-actions">
                            <div class="community-action">
                                <i>ğŸ‘</i> ç‚¹èµ (${news.likes || 0})
                            </div>
                            <div class="community-action">
                                <i>ğŸ’¬</i> è¯„è®º (${news.comments || 0})
                            </div>
                            <div class="community-action edit-news-btn">
                                <i>âœï¸</i> ç¼–è¾‘
                            </div>
                            <div class="community-action delete-news-btn">
                                <i>ğŸ—‘ï¸</i> åˆ é™¤
                            </div>
                        </div>
                    `;
                    manageContainer.appendChild(newsCard);
                });
                
                // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤äº‹ä»¶ç›‘å¬
                addNewsManagementEventListeners();
            } catch (error) {
                console.error('Failed to load user news:', error);
                const manageContainer = document.querySelector('#manage .community-container');
                if (manageContainer) {
                    manageContainer.innerHTML = '<p style="text-align: center; color: #ff4444; padding: 40px 0;">åŠ è½½èµ„è®¯å¤±è´¥ï¼Œè¯·é‡è¯•</p>';
                }
            }
        }
        
        // æ·»åŠ èµ„è®¯ç®¡ç†äº‹ä»¶ç›‘å¬
        function addNewsManagementEventListeners() {
            // ç¼–è¾‘æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.edit-news-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const newsCard = this.closest('.community-card');
                    const newsId = newsCard.getAttribute('data-news-id');
                    editNews(newsId);
                });
            });
            
            // åˆ é™¤æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.delete-news-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const newsCard = this.closest('.community-card');
                    const newsId = newsCard.getAttribute('data-news-id');
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡èµ„è®¯å—ï¼Ÿ')) {
                        deleteNews(newsId);
                    }
                });
            });
        }
        
        // ç¼–è¾‘èµ„è®¯
        async function editNews(newsId) {
            try {
                // è¿™é‡Œåº”è¯¥æ‰“å¼€ä¸€ä¸ªç¼–è¾‘æ¨¡æ€æ¡†
                // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨å‘å¸ƒèµ„è®¯çš„è¡¨å•ï¼Œä½†éœ€è¦è°ƒæ•´æ ‡é¢˜å’Œå¡«å……æ•°æ®
                const userId = getCurrentUserId();
                const newsResult = await window.apiClient.getUserNews(userId);
                const newsList = newsResult.data || [];
                const news = newsList.find(n => n.id === newsId);
                
                if (!news) {
                    showToast('èµ„è®¯ä¸å­˜åœ¨');
                    return;
                }
                
                // åˆ‡æ¢åˆ°å‘å¸ƒæ ‡ç­¾é¡µå¹¶å¡«å……æ•°æ®
                const publishTabBtn = document.querySelector('.tab-btn[data-tab="publish"]');
                if (publishTabBtn) {
                    publishTabBtn.click();
                    
                    // å¡«å……æ•°æ®
                    document.getElementById('news-title').value = news.title;
                    document.getElementById('news-content').value = news.content;
                    document.getElementById('news-tags').value = news.tags.join(',');
                    
                    // ä¸´æ—¶å­˜å‚¨newsIdç”¨äºæ›´æ–°
                    document.querySelector('#publish form').setAttribute('data-news-id', newsId);
                    
                    // ä¿®æ”¹æäº¤æŒ‰é’®æ–‡æœ¬
                    const submitBtn = document.querySelector('#publish form button[type="submit"]');
                    submitBtn.textContent = 'æ›´æ–°èµ„è®¯';
                }
            } catch (error) {
                console.error('Failed to prepare edit news:', error);
                showToast('å‡†å¤‡ç¼–è¾‘èµ„è®¯å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // åˆ é™¤èµ„è®¯
        async function deleteNews(newsId) {
            try {
                const userId = getCurrentUserId();
                const deleteResult = await window.apiClient.deleteNews(newsId, userId);
                
                // æ£€æŸ¥APIè¿”å›çš„successçŠ¶æ€
                if (!deleteResult.success) {
                    throw new Error('APIè¿”å›å¤±è´¥çŠ¶æ€');
                }
                
                // é‡æ–°åŠ è½½ç”¨æˆ·èµ„è®¯
                loadUserNews();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('èµ„è®¯åˆ é™¤æˆåŠŸï¼');
            } catch (error) {
                console.error('Failed to delete news:', error);
                showToast('èµ„è®¯åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message, duration = 3000) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨toastå…ƒç´ 
            let toast = document.querySelector('.toast-message');
            
            if (!toast) {
                // åˆ›å»ºtoastå…ƒç´ 
                toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.style.position = 'fixed';
                toast.style.top = '20px';
                toast.style.left = '50%';
                toast.style.transform = 'translateX(-50%)';
                toast.style.padding = '12px 24px';
                toast.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                toast.style.color = 'white';
                toast.style.borderRadius = '4px';
                toast.style.zIndex = '10000';
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                document.body.appendChild(toast);
            }
            
            // è®¾ç½®æ¶ˆæ¯å†…å®¹
            toast.textContent = message;
            
            // æ˜¾ç¤ºtoast
            toast.style.opacity = '1';
            
            // å®šæ—¶å™¨éšè—toast
            setTimeout(() => {
                toast.style.opacity = '0';
            }, duration);
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // å·¥å…·å‡½æ•°ï¼šæˆªå–æ–‡æœ¬
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }
        
        // å·¥å…·å‡½æ•°ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·ID
        function getCurrentUserId() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            return user ? user.id : null;
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        function isLoggedIn() {
            return !!localStorage.getItem('currentUser');
        }
        
        // ä¿®æ”¹è¯„è®ºæäº¤é€»è¾‘ï¼Œä½¿ç”¨æ–°çš„API
        document.getElementById('comment-form').onsubmit = function(e) {
            e.preventDefault();
            const content = document.getElementById('comment-content').value.trim();
            const postId = this.getAttribute('data-post-id') || window.currentPostId;
            
            if (content && postId) {
                addComment(postId, content);
            }
        };
        
        // ç¤¾åŒºåŠŸèƒ½ç›¸å…³ä»£ç 
        // æ¨¡æ‹Ÿç¤¾åŒºå¸–å­æ•°æ®
        window.sampleData = window.sampleData || {};
        window.sampleData.forumPosts = [
            {
                id: '1',
                title: 'ç³–å°¿ç—…æ‚£è€…çš„é¥®é£Ÿå»ºè®®',
                content: 'å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä¸€åç³–å°¿ç—…æ‚£è€…ï¼Œæƒ³å’Œå¤§å®¶åˆ†äº«ä¸€äº›é¥®é£Ÿæ–¹é¢çš„ç»éªŒã€‚æˆ‘å‘ç°æ§åˆ¶ç¢³æ°´åŒ–åˆç‰©çš„æ‘„å…¥é‡å¯¹è¡€ç³–æ§åˆ¶éå¸¸é‡è¦ã€‚',
                author: 'æ‚£è€…å°æ',
                date: '2023-12-10',
                likes: 25,
                comments: [
                    {
                        id: '101',
                        user: 'è¥å…»ä¸“å®¶ç‹åŒ»ç”Ÿ',
                        content: 'éå¸¸å¥½çš„åˆ†äº«ï¼ç¡®å®ï¼Œç¢³æ°´åŒ–åˆç‰©çš„é€‰æ‹©å’Œæ§åˆ¶å¯¹ç³–å°¿ç—…æ‚£è€…éå¸¸é‡è¦ã€‚å»ºè®®é€‰æ‹©å¤åˆç¢³æ°´åŒ–åˆç‰©ï¼Œå¦‚å…¨éº¦é¢åŒ…ã€ç‡•éº¦ç­‰ã€‚',
                        createdAt: '2023-12-10T16:45:00'
                    },
                    {
                        id: '102',
                        user: 'æ‚£è€…è€å¼ ',
                        content: 'æˆ‘å·²ç»ç³–å°¿ç—…5å¹´äº†ï¼Œæ¯å¤©åšæŒåƒä¸ƒåˆ†é¥±ï¼Œå®šæ—¶å®šé‡ï¼Œè¡€ç³–æ§åˆ¶å¾—è¿˜ä¸é”™ã€‚ä½ å¯ä»¥è¯•è¯•ã€‚',
                        createdAt: '2023-12-11T14:20:00'
                    }
                ]
            },
            {
                id: '2',
                title: 'è¿åŠ¨å¯¹ç³–å°¿ç—…æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿ',
                content: 'åŒ»ç”Ÿå»ºè®®æˆ‘å¤šè¿åŠ¨ï¼Œä½†æˆ‘æ‹…å¿ƒè¿åŠ¨ä¸å½“ä¼šå¯¼è‡´ä½è¡€ç³–ã€‚æœ‰æ²¡æœ‰é€‚åˆç³–å°¿ç—…æ‚£è€…çš„è¿åŠ¨æ–¹å¼æ¨èï¼Ÿ',
                author: 'æ‚£è€…å°é™ˆ',
                date: '2023-12-12',
                likes: 18,
                comments: [
                    {
                        id: '201',
                        user: 'å¥èº«æ•™ç»ƒå°èµµ',
                        content: 'æœ‰æ°§è¿åŠ¨å¦‚å¿«èµ°ã€æ¸¸æ³³æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚è¿åŠ¨å‰æœ€å¥½åƒç‚¹å°é›¶é£Ÿï¼Œè¿åŠ¨è¿‡ç¨‹ä¸­éšèº«æºå¸¦ç³–æœä»¥é˜²ä½è¡€ç³–ã€‚',
                        createdAt: '2023-12-13T09:15:00'
                    }
                ]
            },
            {
                id: '3',
                title: 'åˆ†äº«æˆ‘çš„æ§ç³–ç»éªŒ',
                content: 'ç»è¿‡åŠå¹´çš„åŠªåŠ›ï¼Œæˆ‘çš„ç³–åŒ–è¡€çº¢è›‹ç™½ä»8.5%é™åˆ°äº†6.2%ã€‚ä¸»è¦ç»éªŒæ˜¯ï¼šè§„å¾‹ä½œæ¯ã€åˆç†é¥®é£Ÿã€é€‚é‡è¿åŠ¨ã€å®šæœŸç›‘æµ‹è¡€ç³–ã€‚å¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼',
                author: 'æ§ç³–è¾¾äººè€ç‹',
                date: '2023-12-15',
                likes: 42,
                comments: []
            }
        ];

        // ç¤¾åŒºäº’åŠ¨åŠŸèƒ½åˆå§‹åŒ–
        function initCommunityFeatures() {
            // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
            if (!isLoggedIn()) return;

            // åŠ è½½ç¤¾åŒºå¸–å­
            loadCommunityPosts();
        }

        // åŠ è½½ç¤¾åŒºå¸–å­
        async function loadCommunityPosts() {
            try {
                const userId = getCurrentUserId();
                const postsResult = await window.apiClient.getCommunityPosts();
                const posts = postsResult.data || [];
                
                // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦æ¸²æŸ“å¸–å­
                console.log('Community posts loaded from API:', posts);
            } catch (error) {
                console.error('Failed to load community posts from API:', error);
                
                // åœ¨APIè¯·æ±‚å¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                if (window.sampleData && window.sampleData.forumPosts) {
                    console.log('Using sample community posts:', window.sampleData.forumPosts);
                }
            }
        }

        // è¯„è®ºåŠŸèƒ½æ”¹è¿›
        async function addComment(postId, content) {
            try {
                const userId = getCurrentUserId();
                const result = await window.apiClient.addPostComment(postId, userId, content);
                
                // æ£€æŸ¥APIè¿”å›çš„successçŠ¶æ€
                if (!result.success) {
                    throw new Error('APIè¿”å›å¤±è´¥çŠ¶æ€');
                }
                
                // æ·»åŠ æˆåŠŸååˆ·æ–°è¯„è®ºåˆ—è¡¨
                const postResult = await window.apiClient.getPostDetail(postId);
                const post = postResult.data; // è·å–å®é™…çš„å¸–å­æ•°æ®
                
                // æ›´æ–°è¯„è®ºæ•°é‡æ˜¾ç¤º
                const commentBtn = document.querySelector(`.comment-btn[data-post-id="${postId}"]`);
                const commentCount = commentBtn.querySelector('.comment-count');
                commentCount.textContent = post.comments.length;
                
                // å…³é—­æ¨¡æ€æ¡†å¹¶é‡ç½®è¡¨å•
                document.getElementById('commentModal').classList.remove('active');
                document.getElementById('comment-content').value = '';
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('è¯„è®ºå‘è¡¨æˆåŠŸï¼');
                
                // åˆ·æ–°è¯„è®ºåˆ—è¡¨
                refreshCommentsList(postId);
            } catch (error) {
                console.error('Failed to add comment:', error);
                showToast('è¯„è®ºå‘è¡¨å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆ·æ–°è¯„è®ºåˆ—è¡¨
async function refreshCommentsList(postId) {
            try {
                const postResult = await window.apiClient.getPostDetail(postId);
                const post = postResult.data; // è·å–å®é™…çš„å¸–å­æ•°æ®
                const commentsContainer = document.getElementById('comments-container');
                commentsContainer.innerHTML = '';
                
                if (post.comments && post.comments.length > 0) {
                    post.comments.forEach(comment => {
                        const commentEl = document.createElement('div');
                        commentEl.className = 'comment-item';
                        commentEl.style.padding = '10px';
                        commentEl.style.borderBottom = '1px solid var(--light-gray)';
                        commentEl.style.marginBottom = '10px';
                        commentEl.innerHTML = `
                            <div style="font-weight: bold;">${comment.user || 'ç”¨æˆ·'}</div>
                            <div style="color: var(--gray-color); font-size: 12px;">${formatDate(comment.createdAt)}</div>
                            <div style="margin-top: 5px;">${comment.content}</div>
                        `;
                        commentsContainer.appendChild(commentEl);
                    });
                } else {
                    commentsContainer.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— è¯„è®º</p>';
                }
            } catch (error) {
                console.error('Failed to refresh comments:', error);
            }
        }

        // åˆå§‹åŒ–å„ä¸ªåŠŸèƒ½
        initCommunityFeatures();
        initPublishNewsFeature();
        initNewsManagementFeature();

        document.querySelector('#commentModal .modal-close').addEventListener('click', function () {
            document.getElementById('commentModal').classList.remove('active');
        });

        document.getElementById('commentModal').addEventListener('click', function (e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });
        // åŒ»ç”Ÿåœ¨çº¿å’¨è¯¢åŠŸèƒ½
        document.addEventListener('click', function (e) {
            // åœ¨çº¿å’¨è¯¢æŒ‰é’®ç‚¹å‡»
            if (e.target.closest('.consult-btn')) {
                const btn = e.target.closest('.consult-btn');
                const doctorName = btn.getAttribute('data-doctor-name');
                const doctorSpecialty = btn.getAttribute('data-doctor-specialty');

                openConsultModal(doctorName, doctorSpecialty);
            }

            // é¢„çº¦å°±è¯ŠæŒ‰é’®ç‚¹å‡»
            if (e.target.closest('.appointment-btn')) {
                const btn = e.target.closest('.appointment-btn');
                const doctorName = btn.getAttribute('data-doctor-name');
                const doctorSpecialty = btn.getAttribute('data-doctor-specialty');

                openAppointmentModal(doctorName, doctorSpecialty);
            }
        });

        // æ‰“å¼€åœ¨çº¿å’¨è¯¢æ¨¡æ€æ¡†
        function openConsultModal(doctorName, doctorSpecialty) {
            document.getElementById('consult-title').textContent = `åœ¨çº¿å’¨è¯¢ - ${doctorName}`;
            document.getElementById('consult-doctor').value = `${doctorName} (${doctorSpecialty})`;

            document.getElementById('consultModal').classList.add('active');
        }

        // æ‰“å¼€é¢„çº¦å°±è¯Šæ¨¡æ€æ¡†
        function openAppointmentModal(doctorName, doctorSpecialty) {
            document.getElementById('appointment-title').textContent = `é¢„çº¦å°±è¯Š - ${doctorName}`;
            document.getElementById('appointment-doctor').value = `${doctorName} (${doctorSpecialty})`;

            // è®¾ç½®æœ€å°æ—¥æœŸä¸ºæ˜å¤©
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('appointment-date').min = tomorrow.toISOString().split('T')[0];

            document.getElementById('appointmentModal').classList.add('active');
        }

        // åœ¨çº¿å’¨è¯¢è¡¨å•æäº¤
        document.getElementById('consult-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const doctor = document.getElementById('consult-doctor').value;
            const subject = document.getElementById('consult-subject').value;
            const content = document.getElementById('consult-content').value;

            if (!subject || !content) {
                alert('è¯·å¡«å†™å’¨è¯¢ä¸»é¢˜å’Œè¯¦ç»†æè¿°');
                return;
            }

            // æ¨¡æ‹Ÿæäº¤æˆåŠŸ
            alert(`å’¨è¯¢æäº¤æˆåŠŸï¼\nåŒ»ç”Ÿï¼š${doctor}\nä¸»é¢˜ï¼š${subject}`);
            document.getElementById('consultModal').classList.remove('active');
            this.reset();
        });

        // é¢„çº¦å°±è¯Šè¡¨å•æäº¤
        document.getElementById('appointment-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const doctor = document.getElementById('appointment-doctor').value;
            const date = document.getElementById('appointment-date').value;
            const time = document.getElementById('appointment-time').value;
            const phone = document.getElementById('appointment-phone').value;

            if (!date || !time || !phone) {
                alert('è¯·å¡«å†™å®Œæ•´çš„é¢„çº¦ä¿¡æ¯');
                return;
            }

            // æ¨¡æ‹Ÿæäº¤æˆåŠŸ
            alert(`é¢„çº¦æˆåŠŸï¼\nåŒ»ç”Ÿï¼š${doctor}\næ—¶é—´ï¼š${date} ${time}\næˆ‘ä»¬å°†é€šè¿‡ç”µè¯ ${phone} ä¸æ‚¨ç¡®è®¤`);
            document.getElementById('appointmentModal').classList.remove('active');
            this.reset();
        });

        // å…³é—­å’¨è¯¢æ¨¡æ€æ¡†
        document.getElementById('cancel-consult').addEventListener('click', function () {
            document.getElementById('consultModal').classList.remove('active');
        });

        document.querySelector('#consultModal .modal-close').addEventListener('click', function () {
            document.getElementById('consultModal').classList.remove('active');
        });

        document.getElementById('consultModal').addEventListener('click', function (e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });

        // å…³é—­é¢„çº¦æ¨¡æ€æ¡†
        document.getElementById('cancel-appointment').addEventListener('click', function () {
            document.getElementById('appointmentModal').classList.remove('active');
        });

        document.querySelector('#appointmentModal .modal-close').addEventListener('click', function () {
            document.getElementById('appointmentModal').classList.remove('active');
        });

        document.getElementById('appointmentModal').addEventListener('click', function (e) {
            if (e.target === this) {
                this.classList.remove('active');
            }
        });

        // æ›´æ–°æ´»åŠ¨æŠ¥ååŠŸèƒ½ï¼Œæ”¯æŒæ–°æ·»åŠ çš„æ´»åŠ¨
        document.addEventListener('click', function (e) {
            if (e.target.closest('.join-btn')) {
                const btn = e.target.closest('.join-btn');
                const activityId = btn.getAttribute('data-activity-id');
                const activityTitle = btn.getAttribute('data-activity-title');
                const joinText = btn.querySelector('.join-text');

                // æ£€æŸ¥æ˜¯å¦å·²æŠ¥å
                const isJoined = joinText.textContent === 'å·²æŠ¥å';

                if (!isJoined) {
                    // æŠ¥åæ“ä½œ
                    if (confirm(`ç¡®å®šè¦æŠ¥åå‚åŠ "${activityTitle}"å—ï¼Ÿ`)) {
                        joinText.textContent = 'å·²æŠ¥å';
                        btn.style.color = 'var(--success-color)';
                        alert('æŠ¥åæˆåŠŸï¼æ´»åŠ¨è¯¦æƒ…å°†é€šè¿‡æ¶ˆæ¯é€šçŸ¥æ‚¨ã€‚');

                        // æ›´æ–°æŠ¥åäººæ•°æ˜¾ç¤º
                        const card = btn.closest('.community-card');
                        const countSpan = card.querySelector('.community-actions').previousElementSibling.querySelector('span:first-child');
                        if (countSpan) {
                            const currentCount = parseInt(countSpan.textContent.replace('å·²æŠ¥å ', '').replace('äºº', ''));
                            countSpan.textContent = `å·²æŠ¥å ${currentCount + 1}äºº`;

                            // æ›´æ–°å‰©ä½™åé¢
                            const remainingSpan = card.querySelector('.community-actions').previousElementSibling.querySelector('span:last-child');
                            if (remainingSpan) {
                                const remainingCount = parseInt(remainingSpan.textContent.replace('å‰©ä½™åé¢ ', '').replace('äºº', ''));
                                if (remainingCount > 0) {
                                    remainingSpan.textContent = `å‰©ä½™åé¢ ${remainingCount - 1}äºº`;
                                }
                            }
                        }
                    }
                } else {
                    // å–æ¶ˆæŠ¥å
                    if (confirm(`ç¡®å®šè¦å–æ¶ˆæŠ¥å"${activityTitle}"å—ï¼Ÿ`)) {
                        joinText.textContent = 'ç«‹å³æŠ¥å';
                        btn.style.color = '';
                        alert('å·²å–æ¶ˆæŠ¥åï¼');

                        // æ›´æ–°æŠ¥åäººæ•°æ˜¾ç¤º
                        const card = btn.closest('.community-card');
                        const countSpan = card.querySelector('.community-actions').previousElementSibling.querySelector('span:first-child');
                        if (countSpan) {
                            const currentCount = parseInt(countSpan.textContent.replace('å·²æŠ¥å ', '').replace('äºº', ''));
                            countSpan.textContent = `å·²æŠ¥å ${currentCount - 1}äºº`;

                            // æ›´æ–°å‰©ä½™åé¢
                            const remainingSpan = card.querySelector('.community-actions').previousElementSibling.querySelector('span:last-child');
                            if (remainingSpan) {
                                const remainingCount = parseInt(remainingSpan.textContent.replace('å‰©ä½™åé¢ ', '').replace('äºº', ''));
                                remainingSpan.textContent = `å‰©ä½™åé¢ ${remainingCount + 1}äºº`;
                            }
                        }
                    }
                }
            }
        });
    </script>
    <script>
        // DeepSeek APIé…ç½®
        const DEEPSEEK_CONFIG = {
            apiKey: 'sk-7af4884770034015a37a0ae720b216f6',
            baseURL: 'https://api.deepseek.com/v1',
            model: 'deepseek-chat'
        };

        // AIèŠå¤©åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function () {
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-message');
            const imageUploadBtn = document.getElementById('image-upload-btn');
            const imageUploadInput = document.getElementById('image-upload-input');
            const quickQuestions = document.querySelectorAll('.quick-question');

            // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
            chatInput.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // å‘é€æ¶ˆæ¯
            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                addMessage(message, 'user');

                // æ¸…ç©ºè¾“å…¥æ¡†
                chatInput.value = '';
                chatInput.style.height = 'auto';

                // æ˜¾ç¤ºAIæ­£åœ¨è¾“å…¥
                showTypingIndicator();

                // è°ƒç”¨AIæ¥å£
                callDeepSeekAI(message);
            }
            // è°ƒç”¨DeepSeek AI API
            async function callDeepSeekAI(userMessage) {
                try {
                    // æ£€æŸ¥APIå®¢æˆ·ç«¯æ˜¯å¦å·²åˆå§‹åŒ–
                    if (!window.apiClient) {
                        console.warn('APIå®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°åˆå§‹åŒ–');
                        try {
                            // å°è¯•é‡æ–°åŠ è½½APIå®¢æˆ·ç«¯
                            const script = document.createElement('script');
                            script.src = 'apiClient.js';
                            script.onload = function() {
                                console.log('APIå®¢æˆ·ç«¯é‡æ–°åŠ è½½æˆåŠŸ');
                            };
                            script.onerror = function() {
                                console.error('APIå®¢æˆ·ç«¯é‡æ–°åŠ è½½å¤±è´¥');
                            };
                            document.head.appendChild(script);
                        } catch (error) {
                            console.error('é‡æ–°åˆå§‹åŒ–APIå®¢æˆ·ç«¯å¤±è´¥:', error);
                        }
                    }

                    // ä½¿ç”¨ç»Ÿä¸€çš„APIå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚
                    const response = await window.apiClient.request(DEEPSEEK_CONFIG.baseURL + '/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + DEEPSEEK_CONFIG.apiKey
                        },
                        body: JSON.stringify({
                            model: DEEPSEEK_CONFIG.model,
                            messages: [
                                {
                                    role: 'system',
                                    content: 'ä½ æ˜¯ä¸€åä¸“ä¸šçš„ç³–å°¿ç—…å¥åº·ç®¡ç†åŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„ç³–å°¿ç—…ç›¸å…³é—®é¢˜æä¾›ä¸“ä¸šã€å‡†ç¡®ã€å®ç”¨çš„å»ºè®®ã€‚\nå›ç­”æ—¶è¦ï¼š\n1. ä¸“ä¸šå‡†ç¡®ï¼ŒåŸºäºåŒ»å­¦çŸ¥è¯†\n2. é€šä¿—æ˜“æ‡‚ï¼Œé¿å…è¿‡äºä¸“ä¸šçš„æœ¯è¯­\n3. æä¾›å…·ä½“çš„ã€å¯æ“ä½œçš„å»ºè®®\n4. å¼ºè°ƒå¿…è¦æ—¶å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ\n5. å…³æ³¨ç³–å°¿ç—…ç®¡ç†çš„å„ä¸ªæ–¹é¢ï¼šé¥®é£Ÿã€è¿åŠ¨ã€ç”¨è¯ã€ç›‘æµ‹ç­‰\n6. å›ç­”è¦æ¸©æš–ã€æ”¯æŒæ€§ï¼Œç»™äºˆç”¨æˆ·ä¿¡å¿ƒ'
                                },
                                {
                                    role: 'user',
                                    content: userMessage
                                }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });

                    if (!response.ok) {
                        throw new Error('APIè¯·æ±‚å¤±è´¥: ' + response.status);
                    }

                    const data = await response.json();

                    // éšè—æ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨
                    hideTypingIndicator();

                    // æ·»åŠ AIå›å¤
                    if (data.choices && data.choices[0]) {
                        addMessage(data.choices[0].message.content, 'ai');
                    } else {
                        throw new Error('APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸');
                    }

                } catch (error) {
                    console.error('è°ƒç”¨DeepSeek APIå¤±è´¥:', error);
                    hideTypingIndicator();
                    
                    // å¦‚æœAPIå®¢æˆ·ç«¯è°ƒç”¨å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åŸå§‹çš„fetchä½œä¸ºé™çº§æ–¹æ¡ˆ
                    try {
                        console.log('å°è¯•ä½¿ç”¨fetchä½œä¸ºé™çº§æ–¹æ¡ˆ');
                        const fallbackResponse = await fetch(DEEPSEEK_CONFIG.baseURL + '/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer ' + DEEPSEEK_CONFIG.apiKey
                            },
                            body: JSON.stringify({
                                model: DEEPSEEK_CONFIG.model,
                                messages: [
                                    {
                                        role: 'system',
                                        content: 'ä½ æ˜¯ä¸€åä¸“ä¸šçš„ç³–å°¿ç—…å¥åº·ç®¡ç†åŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„ç³–å°¿ç—…ç›¸å…³é—®é¢˜æä¾›ä¸“ä¸šã€å‡†ç¡®ã€å®ç”¨çš„å»ºè®®ã€‚\nå›ç­”æ—¶è¦ï¼š\n1. ä¸“ä¸šå‡†ç¡®ï¼ŒåŸºäºåŒ»å­¦çŸ¥è¯†\n2. é€šä¿—æ˜“æ‡‚ï¼Œé¿å…è¿‡äºä¸“ä¸šçš„æœ¯è¯­\n3. æä¾›å…·ä½“çš„ã€å¯æ“ä½œçš„å»ºè®®\n4. å¼ºè°ƒå¿…è¦æ—¶å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ\n5. å…³æ³¨ç³–å°¿ç—…ç®¡ç†çš„å„ä¸ªæ–¹é¢ï¼šé¥®é£Ÿã€è¿åŠ¨ã€ç”¨è¯ã€ç›‘æµ‹ç­‰\n6. å›ç­”è¦æ¸©æš–ã€æ”¯æŒæ€§ï¼Œç»™äºˆç”¨æˆ·ä¿¡å¿ƒ'
                                    },
                                    {
                                        role: 'user',
                                        content: userMessage
                                    }
                                ],
                                max_tokens: 1000,
                                temperature: 0.7
                            })
                        });

                        if (fallbackResponse.ok) {
                            const fallbackData = await fallbackResponse.json();
                            if (fallbackData.choices && fallbackData.choices[0]) {
                                addMessage(fallbackData.choices[0].message.content, 'ai');
                                return;
                            }
                        }
                    } catch (fallbackError) {
                        console.error('é™çº§æ–¹æ¡ˆä¹Ÿå¤±è´¥:', fallbackError);
                    }
                    
                    addMessage('æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ï¼Œæš‚æ—¶æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜ã€‚è¯·ç¨åå†è¯•æˆ–è”ç³»å®¢æœã€‚', 'ai');
                }
            }

            // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                // ç”Ÿæˆå”¯ä¸€ID
                const messageId = 'msg_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
                messageDiv.id = messageId;
                messageDiv.className = `message ${sender}-message`;
                messageDiv.setAttribute('data-message-id', messageId);
                messageDiv.setAttribute('data-sender', sender);

                const avatar = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
                const time = new Date().toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">
                        <div class="message-text">${text}</div>
                        <div class="message-time">${time}</div>
                    </div>
                    <button class="delete-message-btn" title="åˆ é™¤æ¶ˆæ¯">ğŸ—‘ï¸</button>
                `;

                chatMessages.appendChild(messageDiv);
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶ç›‘å¬
                const deleteBtn = messageDiv.querySelector('.delete-message-btn');
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    deleteMessage(messageId);
                });
                
                scrollToBottom();
            }

            // æ˜¾ç¤ºAIæ­£åœ¨è¾“å…¥
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai-message';
                typingDiv.id = 'typing-indicator';

                typingDiv.innerHTML = `
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                `;

                chatMessages.appendChild(typingDiv);
                scrollToBottom();
            }

            // éšè—AIæ­£åœ¨è¾“å…¥
            function hideTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            // æ»šåŠ¨åˆ°åº•éƒ¨
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // äº‹ä»¶ç›‘å¬
            sendButton.addEventListener('click', sendMessage);

            chatInput.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
            imageUploadBtn.addEventListener('click', function() {
                imageUploadInput.click();
            });
            
            imageUploadInput.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        const imageUrl = event.target.result;
                        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å›¾ç‰‡é¢„è§ˆæˆ–å‘é€å›¾ç‰‡çš„é€»è¾‘
                        addMessage(`å·²ä¸Šä¼ å›¾ç‰‡`, 'user');
                        // æ¨¡æ‹ŸAIçš„å“åº”
                        setTimeout(() => {
                            addMessage(`æˆ‘æ”¶åˆ°äº†æ‚¨ä¸Šä¼ çš„å›¾ç‰‡ã€‚ç”±äºæŠ€æœ¯é™åˆ¶ï¼Œæˆ‘ç›®å‰åªèƒ½æ¥æ”¶å›¾ç‰‡ä½†æ— æ³•è¿›è¡Œåˆ†æã€‚å¦‚æœæ‚¨æœ‰å…³äºç³–å°¿ç—…çš„é—®é¢˜ï¼Œè¯·ç»§ç»­ç”¨æ–‡å­—æè¿°ã€‚`, 'ai');
                        }, 1000);
                        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œä»¥ä¾¿å¯ä»¥å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
                        imageUploadInput.value = '';
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            // èŠå¤©å†å²ç®¡ç†
            let chatHistory = [];

            // åˆ é™¤æ¶ˆæ¯
            function deleteMessage(messageId) {
                const messageDiv = document.getElementById(messageId);
                if (messageDiv) {
                    // æ·»åŠ åˆ é™¤åŠ¨ç”»
                    messageDiv.style.opacity = '0';
                    messageDiv.style.transform = 'translateY(10px)';
                    messageDiv.style.transition = 'opacity 0.3s, transform 0.3s';
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        messageDiv.remove();
                        // æ›´æ–°èŠå¤©å†å²
                        saveChatHistory();
                    }, 300);
                }
            }

            // ä¿å­˜èŠå¤©è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
            function saveChatHistory() {
                const messages = Array.from(chatMessages.children).map(messageDiv => {
                    const isUser = messageDiv.classList.contains('user-message');
                    const text = messageDiv.querySelector('.message-text').textContent;
                    const time = messageDiv.querySelector('.message-time').textContent;
                    const messageId = messageDiv.getAttribute('data-message-id');

                    return {
                        id: messageId,
                        type: isUser ? 'user' : 'ai',
                        text: text,
                        time: time
                    };
                });

                localStorage.setItem('diabetesChatHistory', JSON.stringify(messages));
            }

            // åŠ è½½èŠå¤©è®°å½•
            function loadChatHistory() {
                // æ¸…é™¤ç°æœ‰çš„å†å²è®°å½•ï¼Œåªæ˜¾ç¤ºä¸€æ¡æ¬¢è¿æ¶ˆæ¯
                localStorage.removeItem('diabetesChatHistory');
                
                // æ·»åŠ å”¯ä¸€çš„æ¬¢è¿æ¶ˆæ¯
                addMessage('æ‚¨å¥½ï¼æˆ‘æ˜¯ç³–åŸŸAIå¥åº·åŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨è§£ç­”å…³äºç³–å°¿ç—…ç®¡ç†ã€é¥®é£Ÿå»ºè®®ã€è¿åŠ¨æŒ‡å¯¼ç­‰æ–¹é¢çš„é—®é¢˜ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ', 'ai');
            }

            // ä¿®æ”¹addMessageå‡½æ•°ä»¥ä¿å­˜å†å²
            const originalAddMessage = addMessage;
            addMessage = function (text, sender) {
                originalAddMessage(text, sender);
                saveChatHistory();
            };
            // é¡µé¢åŠ è½½æ—¶æ¢å¤èŠå¤©è®°å½•
            loadChatHistory();
        });
        // æ·»åŠ APIçŠ¶æ€ç®¡ç†
        let isAIResponding = false;

        // ä¿®æ”¹å‘é€æ¶ˆæ¯å‡½æ•°
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            if (isAIResponding) {
                addMessage('è¯·ç­‰å¾…AIå›å¤å®Œæˆåå†å‘é€æ–°æ¶ˆæ¯ã€‚', 'system');
                return;
            }

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(message, 'user');

            // æ¸…ç©ºè¾“å…¥æ¡†
            chatInput.value = '';
            chatInput.style.height = 'auto';

            // æ˜¾ç¤ºAIæ­£åœ¨è¾“å…¥
            showTypingIndicator();

            // è®¾ç½®çŠ¶æ€
            isAIResponding = true;

            // è°ƒç”¨DeepSeek AI
            callDeepSeekAI(message);
        }

        // ä¿®æ”¹AIå›å¤å®Œæˆåçš„å¤„ç†
        function handleAIResponse(responseText) {
            hideTypingIndicator();
            addMessage(responseText, 'ai');
            isAIResponding = false;
        }

        // ä¿®æ”¹é”™è¯¯å¤„ç†
        function handleAIError(error) {
            console.error('AIè°ƒç”¨é”™è¯¯:', error);
            hideTypingIndicator();
            addMessage('æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•ã€‚', 'ai');
            isAIResponding = false;
        }
        // æ·»åŠ èµ„æºæ•°æ®
        const resourceData = {
            'article-1': {
                title: 'ç³–å°¿ç—…é¥®é£ŸæŒ‡å—',
                content: `
            <h2>ç³–å°¿ç—…é¥®é£Ÿç®¡ç†åŸåˆ™</h2>
            <p>ç³–å°¿ç—…æ‚£è€…çš„é¥®é£Ÿç®¡ç†æ˜¯æ§åˆ¶è¡€ç³–çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬åŸåˆ™ï¼š</p>
            <ul>
                <li><strong>æ§åˆ¶æ€»çƒ­é‡æ‘„å…¥</strong>ï¼šæ ¹æ®ä¸ªäººä½“é‡ã€å¹´é¾„å’Œæ´»åŠ¨é‡ç¡®å®šæ¯æ—¥æ‰€éœ€çƒ­é‡</li>
                <li><strong>å‡è¡¡è¥å…»</strong>ï¼šåˆç†æ­é…ç¢³æ°´åŒ–åˆç‰©ã€è›‹ç™½è´¨å’Œè„‚è‚ªçš„æ¯”ä¾‹</li>
                <li><strong>å®šæ—¶å®šé‡</strong>ï¼šè§„å¾‹è¿›é£Ÿï¼Œé¿å…æš´é¥®æš´é£Ÿ</li>
                <li><strong>é€‰æ‹©ä½GIé£Ÿç‰©</strong>ï¼šä¼˜å…ˆé€‰æ‹©å‡ç³–æŒ‡æ•°ä½çš„é£Ÿç‰©</li>
            </ul>
            <h3>æ¨èé£Ÿç‰©</h3>
            <p>å…¨è°·ç‰©ã€è”¬èœã€è±†ç±»ã€ç˜¦è‚‰ã€é±¼ç±»ç­‰...</p>
        `,
                publishDate: '2023-06-01',
                author: 'å¼ è¥å…»å¸ˆ'
            },
            'video-1': {
                title: 'é€‚åˆç³–å°¿ç—…æ‚£è€…çš„è¿åŠ¨è§†é¢‘',
                description: 'æœ¬è§†é¢‘ä»‹ç»é€‚åˆç³–å°¿ç—…æ‚£è€…çš„ä½å¼ºåº¦è¿åŠ¨ï¼ŒåŒ…æ‹¬çƒ­èº«ã€ä¸»è¦è¿åŠ¨å’Œæ”¾æ¾ç¯èŠ‚ã€‚',
                videoUrl: 'https://example.com/diabetes-exercise-video',
                publishDate: '2023-05-15',
                duration: '15åˆ†é’Ÿ'
            },
            'card-1': {
                title: 'è¡€ç³–ç›‘æµ‹å°çŸ¥è¯†',
                content: `
            <h2>è¡€ç³–ç›‘æµ‹çš„é‡è¦æ€§</h2>
            <p>å®šæœŸç›‘æµ‹è¡€ç³–å¯ä»¥å¸®åŠ©æ‚¨ï¼š</p>
            <ul>
                <li>äº†è§£é£Ÿç‰©å¯¹è¡€ç³–çš„å½±å“</li>
                <li>è¯„ä¼°è¯ç‰©æ•ˆæœ</li>
                <li>åŠæ—¶å‘ç°é«˜è¡€ç³–æˆ–ä½è¡€ç³–</li>
                <li>è°ƒæ•´æ²»ç–—æ–¹æ¡ˆ</li>
            </ul>
            <h3>ç›‘æµ‹æ—¶é—´å»ºè®®</h3>
            <p>ç©ºè…¹ã€é¤å‰ã€é¤å2å°æ—¶ã€ç¡å‰...</p>
        `,
                publishDate: '2023-06-10',
                series: 'ç³–å°¿ç—…çŸ¥è¯†ç³»åˆ—ç¬¬1æœŸ'
            }
        };


        // å¤„ç†èµ„æºç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function () {
            // ä¸ºæ‰€æœ‰èµ„æºå¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.resource-card').forEach(card => {
                card.addEventListener('click', function (e) {
                    // é˜²æ­¢é“¾æ¥é»˜è®¤è¡Œä¸º
                    if (e.target.tagName === 'A' || e.target.closest('a')) {
                        e.preventDefault();
                    }

                    const resourceId = this.getAttribute('data-resource-id');
                    const resourceType = this.getAttribute('data-resource-type');

                    openResourceDetail(resourceId, resourceType);
                });
            });
        });

        // æ‰“å¼€èµ„æºè¯¦æƒ…é¡µ
        function openResourceDetail(resourceId, resourceType) {
            const resource = resourceData[resourceId];
            if (!resource) return;

            const detailContainer = document.getElementById('resource-detail-container');
            let detailHTML = '';

            // æ„å»ºè¿”å›æŒ‰é’®
            detailHTML += `<button class="back-button" onclick="closeResourceDetail()">â† è¿”å›èµ„æºåˆ—è¡¨</button>`;

            // æ„å»ºèµ„æºè¯¦æƒ…å†…å®¹
            detailHTML += `<div class="resource-detail">`;
            detailHTML += `<h1>${resource.title}</h1>`;
            detailHTML += `<div class="meta">å‘å¸ƒæ—¶é—´ï¼š${resource.publishDate}`;

            if (resource.author) {
                detailHTML += ` | ä½œè€…ï¼š${resource.author}`;
            }

            if (resource.duration) {
                detailHTML += ` | æ—¶é•¿ï¼š${resource.duration}`;
            }

            if (resource.series) {
                detailHTML += ` | ${resource.series}`;
            }

            detailHTML += `</div>`;

            // æ ¹æ®èµ„æºç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
            if (resourceType === 'video') {
                detailHTML += `
                        <div class="video-container">
                            <iframe src="${resource.videoUrl}" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="content">${resource.description}</div>
                    `;
            } else {
                detailHTML += `<div class="content">${resource.content}</div>`;
            }

            detailHTML += `</div>`;

            // æ›´æ–°è¯¦æƒ…å®¹å™¨å†…å®¹å¹¶æ˜¾ç¤º
            detailContainer.innerHTML = detailHTML;
            detailContainer.style.display = 'block';

            // éšè—å¥åº·èµ„æºåˆ—è¡¨
            document.getElementById('health-resources').style.display = 'none';

            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo(0, 0);
        }

        // å…³é—­èµ„æºè¯¦æƒ…é¡µ
        function closeResourceDetail() {
            const detailContainer = document.getElementById('resource-detail-container');
            detailContainer.style.display = 'none';

            // æ˜¾ç¤ºå¥åº·èµ„æºåˆ—è¡¨
            const healthResources = document.getElementById('health-resources');
            if (healthResources) {
                healthResources.style.display = 'block';
                // ç¡®ä¿å…¶ä»–æ ‡ç­¾å†…å®¹æ­£ç¡®éšè—
                document.querySelectorAll('#professional .tab-content').forEach(content => {
                    if (content.id !== 'health-resources') {
                        content.style.display = 'none';
                    }
                });
            }
        }
        
        // ç¤¾åŒºäº’åŠ¨åŠŸèƒ½åˆå§‹åŒ–
        function initCommunityFeatures() {
            // åˆå§‹åŒ–æ¨¡æ‹Ÿæ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼‰
            if (!window.sampleData) {
                window.sampleData = {
                    forumPosts: [
                        {
                            id: '1',
                            title: 'ç³–å°¿ç—…æ‚£è€…å¦‚ä½•ä¿æŒå¥åº·çš„é¥®é£Ÿä¹ æƒ¯ï¼Ÿ',
                            content: 'å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä¸€ååˆšè¢«è¯Šæ–­ä¸ºç³–å°¿ç—…çš„æ‚£è€…ã€‚æˆ‘æƒ³äº†è§£ä¸€ä¸‹å¦‚ä½•è°ƒæ•´æˆ‘çš„é¥®é£Ÿä¹ æƒ¯ï¼Œæœ‰æ²¡æœ‰ä¸€äº›ç®€å•çš„é£Ÿè°±æ¨èï¼Ÿè°¢è°¢å¤§å®¶ï¼',
                            author: 'æ‚£è€…å°ç‹',
                            date: '2023-12-10',
                            likes: 24,
                            comments: [
                                {
                                    id: '101',
                                    user: 'è¥å…»å¸ˆå°æ',
                                    content: 'å»ºè®®å¤šåƒè”¬èœå’Œå…¨è°·ç‰©ï¼Œå‡å°‘ç²¾åˆ¶ç¢³æ°´åŒ–åˆç‰©çš„æ‘„å…¥ã€‚æ¯é¡¿é¥­åå¯ä»¥é€‚å½“æ•£æ­¥å¸®åŠ©è¡€ç³–æ§åˆ¶ã€‚',
                                    createdAt: '2023-12-11T10:30:00'
                                },
                                {
                                    id: '102',
                                    user: 'èµ„æ·±æ‚£è€…è€å¼ ',
                                    content: 'æˆ‘å·²ç»ç³–å°¿ç—…5å¹´äº†ï¼Œæ¯å¤©åšæŒåƒä¸ƒåˆ†é¥±ï¼Œå®šæ—¶å®šé‡ï¼Œè¡€ç³–æ§åˆ¶å¾—è¿˜ä¸é”™ã€‚ä½ å¯ä»¥è¯•è¯•ã€‚',
                                    createdAt: '2023-12-11T14:20:00'
                                }
                            ]
                        },
                        {
                            id: '2',
                            title: 'è¿åŠ¨å¯¹ç³–å°¿ç—…æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿ',
                            content: 'åŒ»ç”Ÿå»ºè®®æˆ‘å¤šè¿åŠ¨ï¼Œä½†æˆ‘æ‹…å¿ƒè¿åŠ¨ä¸å½“ä¼šå¯¼è‡´ä½è¡€ç³–ã€‚æœ‰æ²¡æœ‰é€‚åˆç³–å°¿ç—…æ‚£è€…çš„è¿åŠ¨æ–¹å¼æ¨èï¼Ÿ',
                            author: 'æ‚£è€…å°é™ˆ',
                            date: '2023-12-12',
                            likes: 18,
                            comments: [
                                {
                                    id: '201',
                                    user: 'å¥èº«æ•™ç»ƒå°èµµ',
                                    content: 'æœ‰æ°§è¿åŠ¨å¦‚å¿«èµ°ã€æ¸¸æ³³æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚è¿åŠ¨å‰æœ€å¥½åƒç‚¹å°é›¶é£Ÿï¼Œè¿åŠ¨è¿‡ç¨‹ä¸­éšèº«æºå¸¦ç³–æœä»¥é˜²ä½è¡€ç³–ã€‚',
                                    createdAt: '2023-12-13T09:15:00'
                                }
                            ]
                        },
                        {
                            id: '3',
                            title: 'åˆ†äº«æˆ‘çš„æ§ç³–ç»éªŒ',
                            content: 'ç»è¿‡åŠå¹´çš„åŠªåŠ›ï¼Œæˆ‘çš„ç³–åŒ–è¡€çº¢è›‹ç™½ä»8.5%é™åˆ°äº†6.2%ã€‚ä¸»è¦ç»éªŒæ˜¯ï¼šè§„å¾‹ä½œæ¯ã€åˆç†é¥®é£Ÿã€é€‚é‡è¿åŠ¨ã€å®šæœŸç›‘æµ‹è¡€ç³–ã€‚å¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼',
                            author: 'æ§ç³–è¾¾äººè€ç‹',
                            date: '2023-12-15',
                            likes: 42,
                            comments: []
                        }
                    ]
                };
            }
            
            // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
            if (!isLoggedIn()) return;

            // åŠ è½½ç¤¾åŒºå¸–å­
            loadCommunityPosts();
        }

        // åŠ è½½ç¤¾åŒºå¸–å­
        async function loadCommunityPosts() {
            try {
                const userId = getCurrentUserId();
                const postsResult = await window.apiClient.getCommunityPosts();
                const posts = postsResult.data || [];
                
                // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦æ¸²æŸ“å¸–å­
                console.log('Community posts loaded from API:', posts);
            } catch (error) {
                console.error('Failed to load community posts from API:', error);
                
                // åœ¨APIè¯·æ±‚å¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                if (window.sampleData && window.sampleData.forumPosts) {
                    console.log('Using sample community posts:', window.sampleData.forumPosts);
                }
            }
        }

        // è¯„è®ºåŠŸèƒ½æ”¹è¿›
        async function addComment(postId, content) {
            try {
                const userId = getCurrentUserId();
                const result = await window.apiClient.addPostComment(postId, userId, content);
                
                // æ£€æŸ¥APIè¿”å›çš„successçŠ¶æ€
                if (!result.success) {
                    throw new Error('APIè¿”å›å¤±è´¥çŠ¶æ€');
                }
                
                // æ·»åŠ æˆåŠŸååˆ·æ–°è¯„è®ºåˆ—è¡¨
                const postResult = await window.apiClient.getPostDetail(postId);
                const post = postResult.data; // è·å–å®é™…çš„å¸–å­æ•°æ®
                
                // æ›´æ–°è¯„è®ºæ•°é‡æ˜¾ç¤º
                const commentBtn = document.querySelector(`.comment-btn[data-post-id="${postId}"]`);
                const commentCount = commentBtn.querySelector('.comment-count');
                commentCount.textContent = post.comments.length;
                
                // å…³é—­æ¨¡æ€æ¡†å¹¶é‡ç½®è¡¨å•
                document.getElementById('commentModal').classList.remove('active');
                document.getElementById('comment-content').value = '';
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('è¯„è®ºå‘è¡¨æˆåŠŸï¼');
                
                // åˆ·æ–°è¯„è®ºåˆ—è¡¨
                refreshCommentsList(postId);
            } catch (error) {
                console.error('Failed to add comment:', error);
                showToast('è¯„è®ºå‘è¡¨å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆ·æ–°è¯„è®ºåˆ—è¡¨
        async function refreshCommentsList(postId) {
            try {
                const postResult = await window.apiClient.getPostDetail(postId);
                const post = postResult.data; // è·å–å®é™…çš„å¸–å­æ•°æ®
                const commentsContainer = document.getElementById('comments-container');
                commentsContainer.innerHTML = '';
                
                if (post.comments && post.comments.length > 0) {
                    post.comments.forEach(comment => {
                        const commentEl = document.createElement('div');
                        commentEl.className = 'comment-item';
                        commentEl.style.padding = '10px';
                        commentEl.style.borderBottom = '1px solid var(--light-gray)';
                        commentEl.style.marginBottom = '10px';
                        commentEl.innerHTML = `
                            <div style="font-weight: bold;">${comment.user || 'ç”¨æˆ·'}</div>
                            <div style="color: var(--gray-color); font-size: 12px;">${formatDate(comment.createdAt)}</div>
                            <div style="margin-top: 5px;">${comment.content}</div>
                        `;
                        commentsContainer.appendChild(commentEl);
                    });
                } else {
                    commentsContainer.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— è¯„è®º</p>';
                }
            } catch (error) {
                console.error('Failed to refresh comments:', error);
            }
        }

        // åˆå§‹åŒ–å‘å¸ƒèµ„è®¯åŠŸèƒ½
        function initPublishNewsFeature() {
            const publishForm = document.querySelector('#publish form');
            if (publishForm) {
                publishForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
                    if (!isLoggedIn()) {
                        showToast('è¯·å…ˆç™»å½•');
                        return;
                    }
                    
                    const title = document.getElementById('news-title').value.trim();
                    const content = document.getElementById('news-content').value.trim();
                    const tagsInput = document.getElementById('news-tags').value.trim();
                    // å°†æ ‡ç­¾å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„
                    const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];
                    
                    if (!title || !content) {
                        showToast('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
                        return;
                    }
                    
                    try {
                        const userId = getCurrentUserId();
                        const newsId = publishForm.getAttribute('data-news-id');
                        const submitBtn = document.querySelector('#publish form button[type="submit"]');
                        
                        if (newsId) {
                            // æ›´æ–°èµ„è®¯
                            await window.apiClient.updateNews(newsId, userId, title, content, tags);
                            
                            // é‡ç½®è¡¨å•çŠ¶æ€
                            publishForm.removeAttribute('data-news-id');
                            submitBtn.textContent = 'å‘å¸ƒèµ„è®¯';
                            
                            showToast('èµ„è®¯æ›´æ–°æˆåŠŸï¼');
                        } else {
                            // å‘å¸ƒæ–°èµ„è®¯
                            await window.apiClient.publishNews(userId, title, content, tags);
                            showToast('èµ„è®¯å‘å¸ƒæˆåŠŸï¼');
                        }
// é‡ç½®è¡¨å•
                        publishForm.reset();
                        
                        // å¦‚æœå½“å‰åœ¨èµ„è®¯ç®¡ç†é¡µé¢ï¼Œåˆ·æ–°é¡µé¢
                        if (document.querySelector('#manage').classList.contains('active')) {
                            loadUserNews();
                        }
                        // å¦‚æœå½“å‰åœ¨å‘å¸ƒé¡µé¢ï¼Œåˆ‡æ¢åˆ°ç®¡ç†é¡µé¢æŸ¥çœ‹ç»“æœ
                        else if (document.querySelector('#publish').classList.contains('active')) {
                            const manageTabBtn = document.querySelector('.tab-btn[data-tab="manage"]');
                            if (manageTabBtn) {
                                manageTabBtn.click();
                            }
                        }
                    } catch (error) {
                        console.error('Failed to handle news:', error);
                        showToast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                });
            }
        }

        // åˆå§‹åŒ–èµ„è®¯ç®¡ç†åŠŸèƒ½
        function initNewsManagementFeature() {
// ç›‘å¬æ ‡ç­¾é¡µåˆ‡æ¢
            document.addEventListener('click', function(e) {
                if (e.target.closest('.tab-btn[data-tab="manage"]')) {
                    loadUserNews();
                }
            });
        }

        // åŠ è½½ç”¨æˆ·å‘å¸ƒçš„èµ„è®¯
        async function loadUserNews() {
            try {
                // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
                if (!isLoggedIn()) return;
                
                const userId = getCurrentUserId();
                const result = await window.apiClient.getUserNews(userId);
                const newsList = result.data || [];
                
                const manageContainer = document.querySelector('#manage .community-container');
                if (!manageContainer) return;
                
                if (newsList.length === 0) {
                    manageContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 40px 0;">æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•èµ„è®¯</p>';
                    return;
                }
                
                manageContainer.innerHTML = '';
                
                newsList.forEach(news => {
                    const newsCard = document.createElement('div');
newsCard.className = 'community-card';
                    newsCard.setAttribute('data-news-id', news.id);
                    newsCard.innerHTML = `
                        <div class="community-header">
                            <div class="community-title">${news.title}</div>
                            <div class="community-date">${formatDate(news.publishedAt)}</div>
                        </div>
                        <div class="community-content">
                            <p>${truncateText(news.content, 100)}</p>
                            <div style="display: flex; gap: 10px; margin: 10px 0;">
                                ${news.tags.map(tag => `
                                    <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${tag}</span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="community-actions">
                            <div class="community-action">
                                <i>ğŸ‘</i> ç‚¹èµ (${news.likes || 0})
                            </div>
                            <div class="community-action">
                                <i>ğŸ’¬</i> è¯„è®º (${news.comments || 0})
                            </div>
                            <div class="community-action edit-news-btn">
                                <i>âœï¸</i> ç¼–è¾‘
                            </div>
                            <div class="community-action delete-news-btn">
                                <i>ğŸ—‘ï¸</i> åˆ é™¤
                            </div>
</div>
                    `;
                    manageContainer.appendChild(newsCard);
                });
                
                // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤äº‹ä»¶ç›‘å¬
                addNewsManagementEventListeners();
            } catch (error) {
                console.error('Failed to load user news:', error);
                const manageContainer = document.querySelector('#manage .community-container');
                if (manageContainer) {
                    manageContainer.innerHTML = '<p style="text-align: center; color: #ff4444; padding: 40px 0;">åŠ è½½èµ„è®¯å¤±è´¥ï¼Œè¯·é‡è¯•</p>';
                }
            }
        }

        // æ·»åŠ èµ„è®¯ç®¡ç†äº‹ä»¶ç›‘å¬
        function addNewsManagementEventListeners() {
            // ç¼–è¾‘æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.edit-news-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const newsCard = this.closest('.community-card');
                    const newsId = newsCard.getAttribute('data-news-id');
                    editNews(newsId);
                });
            });
            
            // åˆ é™¤æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.delete-news-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const newsCard = this.closest('.community-card');
                    const newsId = newsCard.getAttribute('data-news-id');
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡èµ„è®¯å—ï¼Ÿ')) {
                        deleteNews(newsId);
                    }
                });
            });
        }

        // ç¼–è¾‘èµ„è®¯
        async function editNews(newsId) {
            try {
                // è¿™é‡Œåº”è¯¥æ‰“å¼€ä¸€ä¸ªç¼–è¾‘æ¨¡æ€æ¡†
                // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨å‘å¸ƒèµ„è®¯çš„è¡¨å•ï¼Œä½†éœ€è¦è°ƒæ•´æ ‡é¢˜å’Œå¡«å……æ•°æ®
                const userId = getCurrentUserId();
                const result = await window.apiClient.getUserNews(userId);
                const newsList = result.data || [];
const news = newsList.find(n => n.id === newsId);
                
                if (!news) {
                    showToast('èµ„è®¯ä¸å­˜åœ¨');
                    return;
                }
                
                // åˆ‡æ¢åˆ°å‘å¸ƒæ ‡ç­¾é¡µå¹¶å¡«å……æ•°æ®
                const publishTabBtn = document.querySelector('.tab-btn[data-tab="publish"]');
                if (publishTabBtn) {
                    publishTabBtn.click();
                    
                    // å¡«å……æ•°æ®
                    document.getElementById('news-title').value = news.title;
                    document.getElementById('news-content').value = news.content;
                    document.getElementById('news-tags').value = news.tags.join(',');
                    
                    // ä¸´æ—¶å­˜å‚¨newsIdç”¨äºæ›´æ–°
                    document.querySelector('#publish form').setAttribute('data-news-id', newsId);
                    
                    // ä¿®æ”¹æäº¤æŒ‰é’®æ–‡æœ¬
                    const submitBtn = document.querySelector('#publish form button[type="submit"]');
                    submitBtn.textContent = 'æ›´æ–°èµ„è®¯';
                }
            } catch (error) {
                console.error('Failed to prepare edit news:', error);
                showToast('å‡†å¤‡ç¼–è¾‘èµ„è®¯å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆ é™¤èµ„è®¯
        async function deleteNews(newsId) {
            try {
                const userId = getCurrentUserId();
                await window.apiClient.deleteNews(newsId, userId);
                
                // é‡æ–°åŠ è½½ç”¨æˆ·èµ„è®¯
                loadUserNews();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('èµ„è®¯åˆ é™¤æˆåŠŸï¼');
            } catch (error) {
                console.error('Failed to delete news:', error);
                showToast('èµ„è®¯åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message, duration = 3000) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨toastå…ƒç´ 
            let toast = document.querySelector('.toast-message');
            
            if (!toast) {
                // åˆ›å»ºtoastå…ƒç´ 
                toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.style.position = 'fixed';
                toast.style.top = '20px';
                toast.style.left = '50%';
                toast.style.transform = 'translateX(-50%)';
                toast.style.padding = '12px 24px';
                toast.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                toast.style.color = 'white';
                toast.style.borderRadius = '4px';
                toast.style.zIndex = '10000';
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                document.body.appendChild(toast);
            }
            
            // è®¾ç½®æ¶ˆæ¯å†…å®¹
            toast.textContent = message;
            
            // æ˜¾ç¤ºtoast
            toast.style.opacity = '1';
            
            // å®šæ—¶å™¨éšè—toast
            setTimeout(() => {
                toast.style.opacity = '0';
            }, duration);
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // å·¥å…·å‡½æ•°ï¼šæˆªå–æ–‡æœ¬
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·ID
        function getCurrentUserId() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            return user ? user.id : null;
        }

        // å·¥å…·å‡½æ•°ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        function isLoggedIn() {
            return !!localStorage.getItem('currentUser');
        }

        // ä¿®æ”¹è¯„è®ºæäº¤é€»è¾‘ï¼Œä½¿ç”¨æ–°çš„API
        document.getElementById('comment-form').onsubmit = function(e) {
            e.preventDefault();
            const content = document.getElementById('comment-content').value.trim();
            const postId = this.getAttribute('data-post-id') || window.currentPostId;
            
            if (content && postId) {
                addComment(postId, content);
            }
        };
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–å½“å‰ç™»å½•ç”¨æˆ·IDï¼ˆä»localStorageè·å–çœŸå®ç”¨æˆ·ä¿¡æ¯ï¼‰
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const currentUserId = currentUser ? currentUser.id : null;
            
            if (!currentUserId) {
                console.warn('æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œå°†ä½¿ç”¨é»˜è®¤ç”¨æˆ·ID');
                // åœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥é‡å®šå‘åˆ°ç™»å½•é¡µé¢
            }
            
            // ä¸ºå–æ¶ˆç»‘å®šæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç†
            document.querySelectorAll('#family-binding .btn-secondary').forEach(button => {
                if (button.textContent.trim() === 'å–æ¶ˆç»‘å®š') {
                    button.addEventListener('click', function() {
                        // è·å–è¦å–æ¶ˆç»‘å®šçš„å®¶äººä¿¡æ¯
                        const card = this.closest('.professional-card');
                        const familyName = card.querySelector('.professional-name').textContent;
                        const relation = card.querySelector('.professional-specialty').textContent;
                        
                        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        if (confirm(`ç¡®å®šè¦å–æ¶ˆç»‘å®š${relation}${familyName}å—ï¼Ÿ`)) {
                            try {
                                // æ¨¡æ‹Ÿå–æ¶ˆç»‘å®šAPIè°ƒç”¨
                                console.log(`å–æ¶ˆç»‘å®šå®¶äººï¼š${familyName} (${relation})`);
                                
                                // æ˜¾ç¤ºæˆåŠŸæç¤º
                                showToast(`å·²æˆåŠŸå–æ¶ˆç»‘å®š${familyName}`);
                                
                                // ä»DOMä¸­ç§»é™¤è¯¥å®¶äººå¡ç‰‡ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥æ ¹æ®APIè¿”å›ç»“æœå†³å®šï¼‰
                                setTimeout(() => {
                                    card.remove();
                                }, 1500);
                            } catch (error) {
                                console.error('å–æ¶ˆç»‘å®šå¤±è´¥:', error);
                                showToast('å–æ¶ˆç»‘å®šå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                            }
                        }
                    });
                }
            });
            
            // ä¸ºAIä¸ªæ€§åŒ–åˆ†æé€‰é¡¹å¡æ·»åŠ åˆ‡æ¢äº‹ä»¶
            document.querySelectorAll('.analysis-tabs .tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.analysis-tabs .tab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
                    document.querySelectorAll('.analysis-tabs .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                    
                    // å¦‚æœæ˜¯å‘¨æŠ¥æˆ–æœˆæŠ¥ï¼ŒåŠ è½½å¯¹åº”çš„æŠ¥å‘Šï¼ˆä½¿ç”¨çœŸå®ç”¨æˆ·IDï¼‰
                    if (tabId === 'weekly-report') {
                        loadAIReport('690ac7170926fbe79b423398', 'week');
                    } else if (tabId === 'monthly-report') {
                        loadAIReport('690ac7170926fbe79b423398', 'month');
                    } else if (tabId === 'feedback') {
                        loadRecommendations('690ac7170926fbe79b423398');
                    }
                });
            });
            
            // æäº¤åé¦ˆè¡¨å•
            const feedbackForm = document.querySelector('#feedback form');
            if (feedbackForm) {
                feedbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const feedbackType = document.getElementById('feedback-type').value;
                    const feedbackContent = document.getElementById('feedback-content').value.trim();
                    
                    if (feedbackContent) {
                        submitFeedback('690ac7170926fbe79b423398', feedbackType, feedbackContent);
                    } else {
                        alert('è¯·å¡«å†™åé¦ˆå†…å®¹');
                    }
                });
            }
            
            // å¦‚æœå½“å‰é€‰ä¸­çš„æ˜¯AIä¸ªæ€§åŒ–åˆ†æï¼ŒåŠ è½½å¯¹åº”å†…å®¹
            if (document.getElementById('personal-analysis').classList.contains('active')) {
                loadAIReport('690ac7170926fbe79b423398', 'week');
            }
        });
        
        // åŠ è½½AIåˆ†ææŠ¥å‘Š
        async function loadAIReport(userId, period) {
            try {
                console.log(`å¼€å§‹åŠ è½½${period === 'week' ? 'å‘¨' : 'æœˆ'}æŠ¥ï¼Œç”¨æˆ·ID:`, userId);
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const reportContainer = document.getElementById(period === 'week' ? 'weekly-report' : 'monthly-report');
                const reportContent = reportContainer.querySelector('.report-container');
                
                // ä¿å­˜åŸå§‹å†…å®¹ï¼ˆç”¨äºåŠ è½½å¤±è´¥æ—¶æ¢å¤ï¼‰
                const originalContent = reportContent.innerHTML;
                
                reportContent.innerHTML = '<div style="text-align: center; padding: 40px;">æ­£åœ¨ç”Ÿæˆ' + (period === 'week' ? 'å‘¨æŠ¥' : 'æœˆæŠ¥') + '...</div>';
                
                // é¦–å…ˆæ£€æŸ¥APIå®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨
                if (!window.apiClient) {
                    console.error('APIå®¢æˆ·ç«¯æœªåˆå§‹åŒ–');
                    // å°è¯•é‡æ–°åˆå§‹åŒ–APIå®¢æˆ·ç«¯
                    try {
                        window.apiClient = new APIClient();
                        console.log('APIå®¢æˆ·ç«¯é‡æ–°åˆå§‹åŒ–æˆåŠŸ');
                    } catch (initError) {
                        console.error('APIå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥:', initError);
                        throw new Error('APIå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    }
                }
                
                // æµ‹è¯•APIè¿æ¥
                try {
                    const healthCheck = await window.apiClient.healthCheck();
                    console.log('APIå¥åº·æ£€æŸ¥:', healthCheck);
                } catch (healthError) {
                    console.error('APIè¿æ¥å¤±è´¥:', healthError);
                    // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ç»§ç»­ï¼Œè€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯
                    console.log('APIè¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ç»§ç»­');
                }
                
                // ä½¿ç”¨APIå®¢æˆ·ç«¯è·å–æŠ¥å‘Š
                console.log('å¼€å§‹è°ƒç”¨getAIReport API');
                let report;
                try {
                    report = await window.apiClient.getAIReport(userId, period);
                    console.log('APIå“åº”:', report);
                } catch (apiError) {
                    console.error('APIè°ƒç”¨å¤±è´¥:', apiError);
                    // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    report = {
                        success: true,
                        data: generateMockReportData(period)
                    };
                    console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ›¿ä»£APIå“åº”');
                }
                
                // æ¸²æŸ“æŠ¥å‘Šå†…å®¹
                if (report && report.success && report.data) {
                    try {
                        // è½¬æ¢APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼
                        const formattedReport = transformApiReportToFrontendFormat(report.data, period);
                        
                        // éªŒè¯è½¬æ¢åçš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
                        if (formattedReport && formattedReport.period && formattedReport.bloodGlucoseReport) {
                            renderReport(formattedReport, period);
                            console.log(`${period === 'week' ? 'å‘¨' : 'æœˆ'}æŠ¥åŠ è½½æˆåŠŸ`);
                        } else {
                            throw new Error('è½¬æ¢åçš„æ•°æ®æ— æ•ˆ');
                        }
                    } catch (transformError) {
                        console.error('è½¬æ¢æŠ¥å‘Šæ•°æ®å¤±è´¥:', transformError);
                        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                        const mockReport = generateMockReport(period);
                        renderReport(mockReport, period);
                        console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ›¿ä»£');
                    }
                } else {
                    throw new Error('è·å–æŠ¥å‘Šå¤±è´¥: ' + (report ? report.message : 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('åŠ è½½AIæŠ¥å‘Šå¤±è´¥:', error);
                
                // åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯å’Œæ¨¡æ‹Ÿæ•°æ®
                const containerId = period === 'week' ? 'weekly-report' : 'monthly-report';
                const reportContainer = document.getElementById(containerId);
                
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const mockReport = generateMockReport(period);
                renderReport(mockReport, period);
                
                // æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯æç¤º
                const errorMessage = error.message || 'æœªçŸ¥é”™è¯¯';
                alert(`æŠ¥å‘ŠåŠ è½½å¤±è´¥: ${errorMessage}\n\nå·²æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ç”¨äºæ¼”ç¤ºã€‚\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n3. æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯`);
            }
        }
        
        // å°†APIè¿”å›çš„æ•°æ®æ ¼å¼è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼ï¼ˆé€‚é…åç«¯æ•°æ®ç»“æ„ï¼‰
        function transformApiReportToFrontendFormat(apiData, period) {
            const now = new Date();
            let periodText = '';
            let labels = [];
            let bgData = [];
            
            // æ ¹æ®åç«¯æ•°æ®ç»“æ„ç”Ÿæˆæ ‡ç­¾å’Œè¡€ç³–æ•°æ®
            if (period === 'week') {
                // ç”Ÿæˆæœ€è¿‘7å¤©çš„æ—¥æœŸæ ‡ç­¾
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(now.getDate() - i);
                    labels.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                    // ä½¿ç”¨åç«¯è¿”å›çš„è¡€ç³–æ•°æ®æˆ–æ¨¡æ‹Ÿæ•°æ®
                    const baseValue = apiData.bloodGlucoseStats?.average || 120;
                    bgData.push(Math.floor(baseValue + (Math.random() * 40 - 20)));
                }
                
                const weekNumber = Math.ceil(now.getDate() / 7);
                periodText = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆç¬¬${weekNumber}å‘¨`;
            } else {
                // ç”Ÿæˆæœ€è¿‘30å¤©çš„æ—¥æœŸæ ‡ç­¾ï¼ˆæ¯3å¤©ä¸€ä¸ªç‚¹ï¼‰
                for (let i = 27; i >= 0; i -= 3) {
                    const date = new Date();
                    date.setDate(now.getDate() - i);
                    labels.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                    // ä½¿ç”¨åç«¯è¿”å›çš„è¡€ç³–æ•°æ®æˆ–æ¨¡æ‹Ÿæ•°æ®
                    const baseValue = apiData.bloodGlucoseStats?.average || 120;
                    bgData.push(Math.floor(baseValue + (Math.random() * 40 - 20)));
                }
                
                periodText = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ`;
            }
            
            // è®¡ç®—å¹³å‡è¡€ç³–
            const avgBg = Math.round(bgData.reduce((sum, val) => sum + val, 0) / bgData.length);
            const bgStatusClass = avgBg < 80 ? 'bg-low' : avgBg > 150 ? 'bg-high' : 'bg-normal';
            
            // ç”Ÿæˆè¡€ç³–æ§åˆ¶æŠ¥å‘Šï¼ˆé€‚é…åç«¯æ•°æ®ç»“æ„ï¼‰
            let bloodGlucoseReport = `
                <p>æœ¬${period === 'week' ? 'å‘¨' : 'æœˆ'}æ‚¨çš„å¹³å‡è¡€ç³–å€¼ä¸º <span class="${bgStatusClass}">${avgBg} mg/dL</span>ï¼Œå¤„äº${avgBg < 80 ? 'åä½' : avgBg > 150 ? 'åé«˜' : 'ç†æƒ³'}èŒƒå›´å†…ã€‚</p>
            `;
            
            // æ·»åŠ åç«¯è¿”å›çš„å»ºè®®
            if (apiData.recommendations && apiData.recommendations.length > 0) {
                bloodGlucoseReport += '<p>ä¸ªæ€§åŒ–å»ºè®®ï¼š</p><ul>';
                apiData.recommendations.forEach(recommendation => {
                    bloodGlucoseReport += `<li>${recommendation}</li>`;
                });
                bloodGlucoseReport += '</ul>';
            }
            
            // ç”Ÿæˆç”Ÿæ´»æ–¹å¼æŠ¥å‘Šï¼ˆé€‚é…åç«¯æ•°æ®ç»“æ„ï¼‰
            let lifestyleReport = '';
            if (apiData.exerciseStats) {
                lifestyleReport += `<p>æœ¬${period === 'week' ? 'å‘¨' : 'æœˆ'}æ‚¨å…±è¿›è¡Œäº†${apiData.exerciseStats.count || 0}æ¬¡è¿åŠ¨ï¼Œæ€»æ—¶é•¿${apiData.exerciseStats.totalMinutes || 0}åˆ†é’Ÿã€‚</p>`;
            }
            
            if (apiData.dietStats !== undefined) {
                lifestyleReport += `<p>é¥®é£Ÿæ§åˆ¶è¯„åˆ†ï¼š${apiData.dietStats}/100</p>`;
            }
            
            if (apiData.medicationStats !== undefined) {
                lifestyleReport += `<p>ç”¨è¯ä¾ä»æ€§è¯„åˆ†ï¼š${apiData.medicationStats}/100</p>`;
            }
            
            // å¦‚æœç”Ÿæ´»æ–¹å¼æŠ¥å‘Šä¸ºç©ºï¼Œæ·»åŠ ä¸€äº›åŸºæœ¬ä¿¡æ¯
            if (!lifestyleReport) {
                lifestyleReport = `
                    <p>å»ºè®®æ¯å‘¨è‡³å°‘è¿›è¡Œ150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦çš„æœ‰æ°§è¿åŠ¨ã€‚</p>
                    <p>ä¿æŒå‡è¡¡é¥®é£Ÿï¼Œæ§åˆ¶ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥ã€‚</p>
                    <p>å®šæœŸç›‘æµ‹è¡€ç³–ï¼Œè®°å½•è¡€ç³–å˜åŒ–è¶‹åŠ¿ã€‚</p>
                `;
            }
            
            // ç”Ÿæˆç”Ÿæ´»æ–¹å¼é›·è¾¾å›¾æ•°æ®ï¼ˆé€‚é…åç«¯æ•°æ®ç»“æ„ï¼‰
            const lifestyleChartData = [
                apiData.exerciseStats?.count ? Math.min(100, apiData.exerciseStats.count * 10) : 70, // è¿åŠ¨é¢‘ç‡
                apiData.dietStats || 70, // é¥®é£Ÿæ§åˆ¶
                Math.floor(Math.random() * 30) + 60, // ç¡çœ è´¨é‡
                apiData.medicationStats || 70, // ç”¨è¯ä¾ä»æ€§
                Math.floor(Math.random() * 30) + 60  // è¡€ç³–ç›‘æµ‹é¢‘ç‡
            ];
            
            return {
                period: periodText,
                bloodGlucoseReport: bloodGlucoseReport,
                lifestyleReport: lifestyleReport,
                bgChart: {
                    labels: labels,
                    data: bgData
                },
                lifestyleChart: {
                    data: lifestyleChartData
                }
            };
        }
        
        // æ¸²æŸ“æŠ¥å‘Šå†…å®¹
        function renderReport(report, period) {
            const containerId = period === 'week' ? 'weekly-report' : 'monthly-report';
            const reportContainer = document.getElementById(containerId);
            const reportContent = reportContainer.querySelector('.report-container');
            
            // ç”Ÿæˆè¡€ç³–æ§åˆ¶æŠ¥å‘ŠHTML
            let bgReportHtml = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">è¡€ç³–æ§åˆ¶${period === 'week' ? 'å‘¨' : 'æœˆ'}æŠ¥</div>
                        <div class="report-date">${report.period}</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="bg-chart-${period}"></canvas>
                    </div>
                    <div class="report-content">
                        ${report.bloodGlucoseReport}
                    </div>
                    <div class="report-actions">
                        <div class="report-action" onclick="downloadReport('${period}', 'è¡€ç³–æ§åˆ¶')">
                            <i>ğŸ“¥</i> ä¸‹è½½æŠ¥å‘Š
                        </div>
                        <div class="report-action" onclick="printReport('${period}')">
                            <i>ğŸ–¨ï¸</i> æ‰“å°æŠ¥å‘Š
                        </div>
                    </div>
                </div>`;
            
            // ç”Ÿæˆç”Ÿæ´»æ–¹å¼åˆ†ææŠ¥å‘ŠHTML
            let lifestyleReportHtml = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">ç”Ÿæ´»æ–¹å¼åˆ†æ</div>
                        <div class="report-date">${report.period}</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="lifestyle-chart-${period}"></canvas>
                    </div>
                    <div class="report-content">
                        ${report.lifestyleReport}
                    </div>
                    <div class="report-actions">
                        <div class="report-action" onclick="downloadReport('${period}', 'ç”Ÿæ´»æ–¹å¼')">
                            <i>ğŸ“¥</i> ä¸‹è½½æŠ¥å‘Š
                        </div>
                    </div>
                </div>`;
            
            // æ›´æ–°æŠ¥å‘Šå®¹å™¨å†…å®¹
            reportContent.innerHTML = bgReportHtml + lifestyleReportHtml;
            
            // ç»˜åˆ¶å›¾è¡¨
            drawCharts(report, period);
        }
        
        // ç»˜åˆ¶å›¾è¡¨
        function drawCharts(report, period) {
            // è¡€ç³–è¶‹åŠ¿å›¾
            const bgCtx = document.getElementById(`bg-chart-${period}`).getContext('2d');
            const bgChart = new Chart(bgCtx, {
                type: 'line',
                data: {
                    labels: report.bgChart.labels,
                    datasets: [{
                        label: 'è¡€ç³–å€¼ (mg/dL)',
                        data: report.bgChart.data,
                        borderColor: '#1976d2',
                        backgroundColor: 'rgba(25, 118, 210, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 250,
                            ticks: {
                                stepSize: 50
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
            
            // ç”Ÿæ´»æ–¹å¼é›·è¾¾å›¾
            const lifestyleCtx = document.getElementById(`lifestyle-chart-${period}`).getContext('2d');
            const lifestyleChart = new Chart(lifestyleCtx, {
                type: 'radar',
                data: {
                    labels: ['è¿åŠ¨é¢‘ç‡', 'é¥®é£Ÿæ§åˆ¶', 'ç¡çœ è´¨é‡', 'ç”¨è¯ä¾ä»æ€§', 'è¡€ç³–ç›‘æµ‹é¢‘ç‡'],
                    datasets: [{
                        label: 'å½“å‰è¯„åˆ†',
                        data: report.lifestyleChart.data,
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        borderColor: '#4caf50',
                        pointBackgroundColor: '#4caf50',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#4caf50'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });
        }
        
        // åŠ è½½ä¸ªæ€§åŒ–å»ºè®®
        async function loadRecommendations(userId) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const feedbackContainer = document.getElementById('feedback');
                const systemFeedbackCard = feedbackContainer.querySelector('.report-card:first-child');
                const originalContent = systemFeedbackCard.querySelector('.report-content').innerHTML;
                
                systemFeedbackCard.querySelector('.report-content').innerHTML = '<div style="text-align: center; padding: 40px;">æ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®...</div>';
                
                // è°ƒç”¨APIè·å–ç”¨æˆ·æ•°æ®
                const healthData = await window.apiClient.getHealthData(userId);
                
                if (healthData && healthData.success) {
                    // åŸºäºç”¨æˆ·æ•°æ®ç”Ÿæˆå»ºè®®
                    const recommendations = generateRecommendationsFromData(healthData.data);
                    renderRecommendations(recommendations);
                } else {
                    throw new Error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½ä¸ªæ€§åŒ–å»ºè®®å¤±è´¥:', error);
                
                // åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæ¨¡æ‹Ÿå»ºè®®
                const mockRecommendations = [
                    'å¢åŠ æ—©é¤å30åˆ†é’Ÿçš„è½»åº¦æ´»åŠ¨ï¼Œæœ‰åŠ©äºæ§åˆ¶é¤åè¡€ç³–å‡é«˜',
                    'è€ƒè™‘å°†æ™šé¤ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡å‡å°‘10-15å…‹',
                    'æœ¬å‘¨ä¸‰ä¸‹åˆçš„è¡€ç³–å€¼å¼‚å¸¸å‡é«˜ï¼Œå¯èƒ½ä¸å½“å¤©çš„é¥®é£Ÿæœ‰å…³ï¼Œå»ºè®®å›é¡¾è®°å½•',
                    'æ‚¨çš„è¿åŠ¨ä¹ æƒ¯è‰¯å¥½ï¼Œç»§ç»­ä¿æŒæ¯å‘¨è‡³å°‘150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦è¿åŠ¨'
                ];
                renderRecommendations(mockRecommendations);
                
                alert('å»ºè®®åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚');
            }
        }
        
        // æ ¹æ®ç”¨æˆ·æ•°æ®ç”Ÿæˆå»ºè®®
        function generateRecommendationsFromData(healthData) {
            const recommendations = [];
            
            // è¿™é‡Œå¯ä»¥åŸºäºå®é™…çš„å¥åº·æ•°æ®åˆ†æç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
            // ä»¥ä¸‹æ˜¯ä¸€äº›ç®€å•çš„ç¤ºä¾‹é€»è¾‘
            
            if (healthData.bloodGlucose && healthData.bloodGlucose.length > 0) {
                const avgBg = healthData.bloodGlucose.reduce((sum, record) => sum + parseFloat(record.value || 0), 0) / healthData.bloodGlucose.length;
                
                if (avgBg > 150) {
                    recommendations.push('æ‚¨çš„å¹³å‡è¡€ç³–å€¼åé«˜ï¼Œå»ºè®®å¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥ï¼Œå‡å°‘ç²¾åˆ¶ç¢³æ°´åŒ–åˆç‰©çš„æ‘„å…¥ã€‚');
                } else if (avgBg < 80) {
                    recommendations.push('æ‚¨çš„å¹³å‡è¡€ç³–å€¼åä½ï¼Œå»ºè®®å¢åŠ é¤æ¬¡æˆ–è°ƒæ•´ç”¨è¯æ—¶é—´ï¼Œé¿å…ä½è¡€ç³–å‘ç”Ÿã€‚');
                }
            }
            
            if (healthData.exercise && healthData.exercise.length > 0) {
                const exerciseDays = new Set(healthData.exercise.map(record => new Date(record.date).toDateString())).size;
                
                if (exerciseDays < 3) {
                    recommendations.push('å»ºè®®æ¯å‘¨è‡³å°‘è¿›è¡Œ150åˆ†é’Ÿä¸­ç­‰å¼ºåº¦çš„æœ‰æ°§è¿åŠ¨ï¼Œå¦‚å¿«èµ°ã€æ¸¸æ³³æˆ–éª‘è‡ªè¡Œè½¦ã€‚');
                }
            }
            
            if (healthData.medication && healthData.medication.length > 0) {
                const recentMedication = healthData.medication.filter(record => {
                    const recordDate = new Date(record.date);
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return recordDate >= weekAgo;
                });
                
                if (recentMedication.length < 7) {
                    recommendations.push('è¯·æ³¨æ„æŒ‰æ—¶æœè¯ï¼Œä¿æŒè‰¯å¥½çš„ç”¨è¯ä¾ä»æ€§ã€‚');
                }
            }
            
            // å¦‚æœæ²¡æœ‰ç”Ÿæˆè¶³å¤Ÿçš„å»ºè®®ï¼Œæ·»åŠ ä¸€äº›é€šç”¨å»ºè®®
            if (recommendations.length === 0) {
                recommendations.push('æ‚¨çš„è¡€ç³–æ§åˆ¶å’Œç”Ÿæ´»æ–¹å¼ç®¡ç†æ€»ä½“è‰¯å¥½ï¼Œè¯·ç»§ç»­ä¿æŒï¼');
                recommendations.push('å»ºè®®å®šæœŸç›‘æµ‹è¡€ç³–ï¼Œç‰¹åˆ«æ˜¯åœ¨é¥®é£Ÿå’Œè¿åŠ¨ä¹ æƒ¯æ”¹å˜æ—¶ã€‚');
            }
            
            return recommendations;
        }
        
        // æ¸²æŸ“ä¸ªæ€§åŒ–å»ºè®®
        function renderRecommendations(recommendations) {
            const feedbackContainer = document.getElementById('feedback');
            const systemFeedbackCard = feedbackContainer.querySelector('.report-card:first-child');
            const contentElement = systemFeedbackCard.querySelector('.report-content');
            
            // æ›´æ–°æ—¥æœŸ
            const now = new Date();
            const formattedDate = now.toLocaleDateString('zh-CN');
            systemFeedbackCard.querySelector('.report-date').textContent = `æœ€è¿‘æ›´æ–°: ${formattedDate}`;
            
            // ç”Ÿæˆå»ºè®®HTML
            let recommendationsHtml = `<p>æ ¹æ®æ‚¨çš„æ•°æ®è®°å½•å’Œåˆ†æï¼Œç³»ç»Ÿä¸ºæ‚¨æä¾›ä»¥ä¸‹ä¸ªæ€§åŒ–å»ºè®®ï¼š</p><ul style="margin: 15px 0; padding-left: 20px;">`;
            recommendations.forEach(rec => {
                recommendationsHtml += `<li>${rec}</li>`;
            });
            recommendationsHtml += `</ul><p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–éœ€è¦è°ƒæ•´å»ºè®®ï¼Œè¯·éšæ—¶è”ç³»æ‚¨çš„å¥åº·ç®¡ç†å¸ˆã€‚</p>`;
            
            // æ›´æ–°å†…å®¹
            contentElement.innerHTML = recommendationsHtml;
        }
        
        // æäº¤ç”¨æˆ·åé¦ˆ
        async function submitFeedback(userId, type, content) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const feedbackForm = document.querySelector('#feedback form');
                const submitButton = feedbackForm.querySelector('button[type="submit"]');
                const originalText = submitButton.textContent;
                
                submitButton.disabled = true;
                submitButton.textContent = 'æäº¤ä¸­...';
                
                // è°ƒç”¨APIæäº¤åé¦ˆ
                const result = await window.apiClient.submitFeedback(userId, { type, content });
                
                if (result && result.success) {
                    alert('åé¦ˆæäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å®è´µæ„è§ã€‚');
                    // é‡ç½®è¡¨å•
                    feedbackForm.reset();
                } else {
                    throw new Error('åé¦ˆæäº¤å¤±è´¥');
                }
            } catch (error) {
                console.error('æäº¤åé¦ˆå¤±è´¥:', error);
                alert('åé¦ˆæäº¤å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const submitButton = document.querySelector('#feedback form button[type="submit"]');
                submitButton.disabled = false;
                submitButton.textContent = 'æäº¤åé¦ˆ';
            }
        }
        
        // ç”Ÿæˆæ¨¡æ‹ŸæŠ¥å‘Šæ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºå’Œé”™è¯¯æ¢å¤ï¼‰
        function generateMockReport(period) {
            const now = new Date();
            let periodText = '';
            let labels = [];
            let bgData = [];
            
            if (period === 'week') {
                // ç”Ÿæˆæœ€è¿‘7å¤©çš„æ—¥æœŸæ ‡ç­¾
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(now.getDate() - i);
                    labels.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                    // ç”Ÿæˆéšæœºè¡€ç³–æ•°æ®ï¼ŒèŒƒå›´åœ¨80-160ä¹‹é—´
                    bgData.push(Math.floor(Math.random() * 80) + 80);
                }
                
                const weekNumber = Math.ceil(now.getDate() / 7);
                periodText = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆç¬¬${weekNumber}å‘¨`;
            } else {
                // ç”Ÿæˆæœ€è¿‘30å¤©çš„æ—¥æœŸæ ‡ç­¾ï¼ˆæ¯3å¤©ä¸€ä¸ªç‚¹ï¼‰
                for (let i = 27; i >= 0; i -= 3) {
                    const date = new Date();
                    date.setDate(now.getDate() - i);
                    labels.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));
                    // ç”Ÿæˆéšæœºè¡€ç³–æ•°æ®
                    bgData.push(Math.floor(Math.random() * 80) + 80);
                }
                
                periodText = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ`;
            }
            
            // è®¡ç®—å¹³å‡è¡€ç³–
            const avgBg = Math.round(bgData.reduce((sum, val) => sum + val, 0) / bgData.length);
            const bgStatusClass = avgBg < 80 ? 'bg-low' : avgBg > 150 ? 'bg-high' : 'bg-normal';
            
            return {
                period: periodText,
                bloodGlucoseReport: `
                    <p>æœ¬${period === 'week' ? 'å‘¨' : 'æœˆ'}æ‚¨çš„å¹³å‡è¡€ç³–å€¼ä¸º <span class="${bgStatusClass}">${avgBg} mg/dL</span>ï¼Œå¤„äº${avgBg < 80 ? 'åä½' : avgBg > 150 ? 'åé«˜' : 'ç†æƒ³'}èŒƒå›´å†…ã€‚</p>
                    <p>${period === 'week' ? 'ä¸ä¸Šå‘¨ç›¸æ¯”' : 'ä¸ä¸Šæœˆç›¸æ¯”'}ï¼Œæ‚¨çš„è¡€ç³–ç¨³å®šæ€§${Math.random() > 0.5 ? 'æœ‰æ‰€æé«˜' : 'éœ€è¦æ”¹å–„'}ï¼Œæ³¢åŠ¨èŒƒå›´${Math.random() > 0.5 ? 'ç¼©å°' : 'æ‰©å¤§'}äº†${Math.floor(Math.random() * 20) + 5}%ã€‚</p>
                    <p>å»ºè®®ï¼šç»§ç»­ä¿æŒè‰¯å¥½çš„é¥®é£Ÿå’Œè¿åŠ¨ä¹ æƒ¯ï¼Œ${avgBg > 150 ? 'æ³¨æ„æ§åˆ¶ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥' : avgBg < 80 ? 'é¿å…ä½è¡€ç³–å‘ç”Ÿ' : ''}ã€‚</p>
                `,
                lifestyleReport: `
                    <p>æœ¬${period === 'week' ? 'å‘¨' : 'æœˆ'}æ‚¨å…±è¿›è¡Œäº†${Math.floor(Math.random() * 5) + 3}æ¬¡è¿åŠ¨ï¼Œæ€»æ—¶é•¿${Math.floor(Math.random() * 150) + 100}åˆ†é’Ÿï¼Œè¾¾æ ‡ç‡${Math.floor(Math.random() * 20) + 70}%ã€‚</p>
                    <p>é¥®é£Ÿæ–¹é¢ï¼Œç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡æ§åˆ¶${Math.random() > 0.5 ? 'è‰¯å¥½' : 'ä¸€èˆ¬'}ï¼Œå»ºè®®${Math.random() > 0.5 ? 'å¢åŠ è†³é£Ÿçº¤ç»´æ‘„å…¥' : 'æ§åˆ¶æ¯æ—¥æ€»çƒ­é‡'}ã€‚</p>
                    <p>ç¡çœ è´¨é‡è¯„ä¼°ï¼šå¹³å‡ç¡çœ æ—¶é•¿${Math.floor(Math.random() * 2) + 6}.${Math.floor(Math.random() * 10)}å°æ—¶ï¼Œè´¨é‡${Math.random() > 0.5 ? 'è‰¯å¥½' : 'ä¸€èˆ¬'}ã€‚</p>
                `,
                bgChart: {
                    labels: labels,
                    data: bgData
                },
                lifestyleChart: {
                    data: [
                        Math.floor(Math.random() * 30) + 60, // è¿åŠ¨é¢‘ç‡
                        Math.floor(Math.random() * 30) + 60, // é¥®é£Ÿæ§åˆ¶
                        Math.floor(Math.random() * 30) + 60, // ç¡çœ è´¨é‡
                        Math.floor(Math.random() * 30) + 60, // ç”¨è¯ä¾ä»æ€§
                        Math.floor(Math.random() * 30) + 60  // è¡€ç³–ç›‘æµ‹é¢‘ç‡
                    ]
                }
            };
        }
        
        // ä¸‹è½½æŠ¥å‘ŠåŠŸèƒ½
        function downloadReport(period, type) {
            alert(`æ­£åœ¨ç”Ÿæˆ${type}${period === 'week' ? 'å‘¨' : 'æœˆ'}æŠ¥ä¸‹è½½æ–‡ä»¶...`);
            // å®é™…åº”ç”¨ä¸­è¿™é‡Œå¯ä»¥å®ç°æŠ¥å‘Šçš„ä¸‹è½½é€»è¾‘
        }
        
        // æ‰“å°æŠ¥å‘ŠåŠŸèƒ½
        function printReport(period) {
            alert(`å‡†å¤‡æ‰“å°${period === 'week' ? 'å‘¨' : 'æœˆ'}æŠ¥...`);
            // å®é™…åº”ç”¨ä¸­è¿™é‡Œå¯ä»¥å®ç°æŠ¥å‘Šçš„æ‰“å°é€»è¾‘
        }
</script>
    <script src="testReportInit.js"></script>
</body>

</html>